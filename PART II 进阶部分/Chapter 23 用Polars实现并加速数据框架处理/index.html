
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2022%20-%20%20%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/">
      
      
        <link rel="next" href="../Chapter%2024%20-%20%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93Clickhouse/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Chapter 23 用Polars实现并加速数据框架处理 - Rust量化金融开发指南</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-23-polars" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Rust量化金融开发指南" class="md-header__button md-logo" aria-label="Rust量化金融开发指南" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Rust量化金融开发指南
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 23 用Polars实现并加速数据框架处理
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/arthur19q3/Cookbook-for-Rustaceans-in-Finance" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    arthur19q3/Cookbook-for-Rustaceans-in-Finance
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Cookbook for Rustaceans in Finance / Rust量化金融开发指南

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2001%20-%20Rust%20%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8/" class="md-tabs__link">
          
  
  
    
  
  PART I 基础部分

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
    
  
  PART II 进阶部分

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Rust量化金融开发指南" class="md-nav__button md-logo" aria-label="Rust量化金融开发指南" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Rust量化金融开发指南
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/arthur19q3/Cookbook-for-Rustaceans-in-Finance" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    arthur19q3/Cookbook-for-Rustaceans-in-Finance
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cookbook for Rustaceans in Finance / Rust量化金融开发指南
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    PART I 基础部分
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            PART I 基础部分
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2001%20-%20Rust%20%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 01 - Rust 语言入门
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2002%20-%20%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 02 - 格式化输出
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2003%20-%20%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 03 - 原生类型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2004%20-%20%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 04 - 自定义类型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2005%20-%20%E6%A0%87%E5%87%86%E5%BA%93%E7%B1%BB%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 05 - 标准库类型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2006%20-%20%E5%8F%98%E9%87%8F%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 06   变量和作用域
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2007%20-%20%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 7 - 类型系统
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2008%20-%20%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 8 - 类型转换
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2009%20-%20%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 9 - 流程控制
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2010%20-%20%E5%87%BD%E6%95%B0%2C%20%E6%96%B9%E6%B3%95%20%E5%92%8C%20%E9%97%AD%E5%8C%85/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 10 - 函数, 方法 和 闭包
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2011%20-%20%E6%A8%A1%E5%9D%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 11 - 模块
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2012%20-%20Cargo%20%E7%9A%84%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 12 - Cargo 的进阶使用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2013%20-%20%E5%B1%9E%E6%80%A7%28Attributes%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 13 - 属性(Attributes)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2014%20-%20%E6%B3%9B%E5%9E%8B%E8%BF%9B%E9%98%B6%28Advanced%20Generic%20Type%20Usage%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 14 - 泛型进阶(Advanced Generic Type Usage)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2015%20-%20%E4%BD%9C%E7%94%A8%E5%9F%9F%E8%A7%84%E5%88%99%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 15 - 作用域规则和生命周期
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2016%20-%20%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E8%BF%9B%E9%98%B6%28Advanced%20Error%20handling%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 16 - 错误处理进阶(Advanced Error handling)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2017%20-%20%E7%89%B9%E6%80%A7%20%28trait%29%20%E8%AF%A6%E8%A7%A3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 17 - 特性 (trait) 详解
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2018%20-%20%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 18 - 创建自定义宏
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2019%20-%20%E6%97%B6%E9%97%B4%E5%A4%84%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 19 - 时间处理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2020%20-%20Redis%E3%80%81%E7%88%AC%E8%99%AB%E3%80%81%E4%BA%A4%E6%98%93%E6%97%A5%E5%BA%93/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 20 - Redis、爬虫、交易日库
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2021%20-%20%E7%BA%BF%E7%A8%8B%E5%92%8C%E7%AE%A1%E9%81%93/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 21 - 线程和管道
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2022%20-%20%20%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 22 - 文件处理
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    PART II 进阶部分
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            PART II 进阶部分
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Chapter 23 用Polars实现并加速数据框架处理
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Chapter 23 用Polars实现并加速数据框架处理
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#231-rustpolars" class="md-nav__link">
    <span class="md-ellipsis">
      23.1 Rust与数据框架处理工具Polars
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.1 Rust与数据框架处理工具Polars">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#polars" class="md-nav__link">
    <span class="md-ellipsis">
      Polars 简介
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      哲学理念
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      主要功能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust" class="md-nav__link">
    <span class="md-ellipsis">
      Rust 中的数据处理框架
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#232-polars" class="md-nav__link">
    <span class="md-ellipsis">
      23.2 开始使用Polars
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.2 开始使用Polars">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2321-polars" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.1 为项目加入polars库
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2322" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.2 读取与写入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2323-polars" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.3 Polars 表达式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.2.3 Polars 表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#23231-select" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.3.1 选择（Select）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust_1" class="md-nav__link">
    <span class="md-ellipsis">
      Rust 示例代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust_2" class="md-nav__link">
    <span class="md-ellipsis">
      Rust 示例代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23232-filter" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.3.2 过滤（Filter）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust_3" class="md-nav__link">
    <span class="md-ellipsis">
      Rust 示例代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust_4" class="md-nav__link">
    <span class="md-ellipsis">
      Rust 示例代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23233-add-columns" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.3.3 添加列（Add Columns）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust_5" class="md-nav__link">
    <span class="md-ellipsis">
      Rust 示例代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23234-group-by" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.3.4 分组（Group by）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      创建 DataFrame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      分组并聚合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23235" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.3.5 组合操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cd" class="md-nav__link">
    <span class="md-ellipsis">
      创建并选择列（排除c、d列）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d" class="md-nav__link">
    <span class="md-ellipsis">
      创建并选择列（排除d列）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2324-dataframes" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.4 合并 DataFrames
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.2.4 合并 DataFrames">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#23241-join" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.4.1 连接（Join）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      数据表连接类型详解
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#left-join" class="md-nav__link">
    <span class="md-ellipsis">
      左连接（Left Join）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#right-join" class="md-nav__link">
    <span class="md-ellipsis">
      右连接（Right Join）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inner-join" class="md-nav__link">
    <span class="md-ellipsis">
      内连接（Inner Join）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outer-join" class="md-nav__link">
    <span class="md-ellipsis">
      外连接（Outer Join）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      示例代码解释
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23242-concat" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.4.2 粘连（Concat）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust_6" class="md-nav__link">
    <span class="md-ellipsis">
      Rust 示例代码
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2325" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.5 基本数据类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.2.5 基本数据类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      数值类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      嵌套类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      时间类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      其他类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      浮点数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      数值类型示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      嵌套类型示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      时间类型示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2326" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.6 数据结构
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.2.6 数据结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      数据结构
    </span>
  </a>
  
    <nav class="md-nav" aria-label="数据结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#series" class="md-nav__link">
    <span class="md-ellipsis">
      Series
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataframe_1" class="md-nav__link">
    <span class="md-ellipsis">
      DataFrame
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      查看数据
    </span>
  </a>
  
    <nav class="md-nav" aria-label="查看数据">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#head" class="md-nav__link">
    <span class="md-ellipsis">
      Head
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tail" class="md-nav__link">
    <span class="md-ellipsis">
      Tail
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample" class="md-nav__link">
    <span class="md-ellipsis">
      Sample
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#describe" class="md-nav__link">
    <span class="md-ellipsis">
      描述（Describe）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#233-polars" class="md-nav__link">
    <span class="md-ellipsis">
      23.3 Polars进阶学习
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.3 Polars进阶学习">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2331-aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.1 聚合操作 Aggregation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      聚合操作在量化金融中的应用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="聚合操作在量化金融中的应用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      基本聚合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      条件聚合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      嵌套分组
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      过滤组内数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      排序
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2332-folds" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.2 Folds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#folds" class="md-nav__link">
    <span class="md-ellipsis">
      Folds
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Folds">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      手动求和
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      条件聚合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      折叠和字符串数据
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2333-csv-input" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.3 CSV input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csv" class="md-nav__link">
    <span class="md-ellipsis">
      CSV
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CSV">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      读取与写入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csv_1" class="md-nav__link">
    <span class="md-ellipsis">
      扫描CSV
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      教程总结
    </span>
  </a>
  
    <nav class="md-nav" aria-label="教程总结">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csv_2" class="md-nav__link">
    <span class="md-ellipsis">
      读取CSV文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csv_3" class="md-nav__link">
    <span class="md-ellipsis">
      写入CSV文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csv_4" class="md-nav__link">
    <span class="md-ellipsis">
      扫描CSV文件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      参考代码示例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="参考代码示例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csv_5" class="md-nav__link">
    <span class="md-ellipsis">
      读取CSV文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csv_6" class="md-nav__link">
    <span class="md-ellipsis">
      写入CSV文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csv_7" class="md-nav__link">
    <span class="md-ellipsis">
      扫描CSV文件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2334-json-input" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.4 JSON input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    <span class="md-ellipsis">
      JSON 文件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JSON 文件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      读取
    </span>
  </a>
  
    <nav class="md-nav" aria-label="读取">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json_1" class="md-nav__link">
    <span class="md-ellipsis">
      标准 JSON
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json_2" class="md-nav__link">
    <span class="md-ellipsis">
      换行分隔的 JSON
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      写入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      扫描
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2335-polars-lazy-eager-api" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.5 Polars的急性和惰性模式 (Lazy / Eager API)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.3.5 Polars的急性和惰性模式 (Lazy / Eager API)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      急性模式示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      惰性模式示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      急性 API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      何时使用哪种模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      量化金融案例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="量化金融案例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sma" class="md-nav__link">
    <span class="md-ellipsis">
      急性模式示例：计算股票的简单移动平均线（SMA）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wma" class="md-nav__link">
    <span class="md-ellipsis">
      惰性模式示例：计算股票的加权移动平均线（WMA）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2336-streaming-mode" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.6 流模式 (Streaming Mode)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.3.6 流模式 (Streaming Mode)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      流模式的关键特性：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      量化金融案例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="量化金融案例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api_1" class="md-nav__link">
    <span class="md-ellipsis">
      急性 API 示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api_2" class="md-nav__link">
    <span class="md-ellipsis">
      惰性 API 示例（带流模式）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      配置块大小
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      流模式的优势
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      使用流模式执行查询
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用流模式执行查询">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      何时可用流模式？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      示例（带支持操作）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      示例（带非流式操作）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2337-missihg-values" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.7 缺失值处理 Missihg Values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#null-nan" class="md-nav__link">
    <span class="md-ellipsis">
      null 和 NaN 值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      缺失数据元数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      填充缺失数据
    </span>
  </a>
  
    <nav class="md-nav" aria-label="填充缺失数据">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      使用指定字面值填充
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      使用策略填充
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      使用表达式填充
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      使用插值填充
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nan" class="md-nav__link">
    <span class="md-ellipsis">
      NaN 值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2338-window-functions" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.8 窗口函数 Window functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      窗口函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="窗口函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      数据集示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      在选择上下文中的分组聚合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      每个分组内的操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    <span class="md-ellipsis">
      窗口表达式规则
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    <span class="md-ellipsis">
      更多示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#polarsdataframe" class="md-nav__link">
    <span class="md-ellipsis">
      案例：序列化 &amp; 转化为polars的dataframe
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%2024%20-%20%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93Clickhouse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 24 - 时序数据库Clickhouse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%2025%20-%20Unsafe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 25 - Unsafe
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%2026%20-%20%E6%96%87%E6%A1%A3%E5%92%8C%E6%B5%8B%E8%AF%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 26 - 文档和测试
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%2027%20%E5%B8%B8%E8%A7%81%E6%8A%80%E6%9C%AF%E6%8C%87%E6%A0%87%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 27 常见技术指标及其实现
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#231-rustpolars" class="md-nav__link">
    <span class="md-ellipsis">
      23.1 Rust与数据框架处理工具Polars
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.1 Rust与数据框架处理工具Polars">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#polars" class="md-nav__link">
    <span class="md-ellipsis">
      Polars 简介
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      哲学理念
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      主要功能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust" class="md-nav__link">
    <span class="md-ellipsis">
      Rust 中的数据处理框架
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#232-polars" class="md-nav__link">
    <span class="md-ellipsis">
      23.2 开始使用Polars
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.2 开始使用Polars">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2321-polars" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.1 为项目加入polars库
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2322" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.2 读取与写入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2323-polars" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.3 Polars 表达式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.2.3 Polars 表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#23231-select" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.3.1 选择（Select）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust_1" class="md-nav__link">
    <span class="md-ellipsis">
      Rust 示例代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust_2" class="md-nav__link">
    <span class="md-ellipsis">
      Rust 示例代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23232-filter" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.3.2 过滤（Filter）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust_3" class="md-nav__link">
    <span class="md-ellipsis">
      Rust 示例代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust_4" class="md-nav__link">
    <span class="md-ellipsis">
      Rust 示例代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23233-add-columns" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.3.3 添加列（Add Columns）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust_5" class="md-nav__link">
    <span class="md-ellipsis">
      Rust 示例代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23234-group-by" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.3.4 分组（Group by）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      创建 DataFrame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      分组并聚合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23235" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.3.5 组合操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cd" class="md-nav__link">
    <span class="md-ellipsis">
      创建并选择列（排除c、d列）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d" class="md-nav__link">
    <span class="md-ellipsis">
      创建并选择列（排除d列）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2324-dataframes" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.4 合并 DataFrames
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.2.4 合并 DataFrames">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#23241-join" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.4.1 连接（Join）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      数据表连接类型详解
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#left-join" class="md-nav__link">
    <span class="md-ellipsis">
      左连接（Left Join）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#right-join" class="md-nav__link">
    <span class="md-ellipsis">
      右连接（Right Join）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inner-join" class="md-nav__link">
    <span class="md-ellipsis">
      内连接（Inner Join）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outer-join" class="md-nav__link">
    <span class="md-ellipsis">
      外连接（Outer Join）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      示例代码解释
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23242-concat" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.4.2 粘连（Concat）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust_6" class="md-nav__link">
    <span class="md-ellipsis">
      Rust 示例代码
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2325" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.5 基本数据类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.2.5 基本数据类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      数值类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      嵌套类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      时间类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      其他类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      浮点数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      数值类型示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      嵌套类型示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      时间类型示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2326" class="md-nav__link">
    <span class="md-ellipsis">
      23.2.6 数据结构
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.2.6 数据结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      数据结构
    </span>
  </a>
  
    <nav class="md-nav" aria-label="数据结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#series" class="md-nav__link">
    <span class="md-ellipsis">
      Series
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataframe_1" class="md-nav__link">
    <span class="md-ellipsis">
      DataFrame
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      查看数据
    </span>
  </a>
  
    <nav class="md-nav" aria-label="查看数据">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#head" class="md-nav__link">
    <span class="md-ellipsis">
      Head
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tail" class="md-nav__link">
    <span class="md-ellipsis">
      Tail
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample" class="md-nav__link">
    <span class="md-ellipsis">
      Sample
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#describe" class="md-nav__link">
    <span class="md-ellipsis">
      描述（Describe）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#233-polars" class="md-nav__link">
    <span class="md-ellipsis">
      23.3 Polars进阶学习
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.3 Polars进阶学习">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2331-aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.1 聚合操作 Aggregation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      聚合操作在量化金融中的应用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="聚合操作在量化金融中的应用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      基本聚合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      条件聚合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      嵌套分组
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      过滤组内数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      排序
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2332-folds" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.2 Folds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#folds" class="md-nav__link">
    <span class="md-ellipsis">
      Folds
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Folds">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      手动求和
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      条件聚合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      折叠和字符串数据
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2333-csv-input" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.3 CSV input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csv" class="md-nav__link">
    <span class="md-ellipsis">
      CSV
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CSV">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      读取与写入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csv_1" class="md-nav__link">
    <span class="md-ellipsis">
      扫描CSV
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      教程总结
    </span>
  </a>
  
    <nav class="md-nav" aria-label="教程总结">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csv_2" class="md-nav__link">
    <span class="md-ellipsis">
      读取CSV文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csv_3" class="md-nav__link">
    <span class="md-ellipsis">
      写入CSV文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csv_4" class="md-nav__link">
    <span class="md-ellipsis">
      扫描CSV文件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      参考代码示例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="参考代码示例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csv_5" class="md-nav__link">
    <span class="md-ellipsis">
      读取CSV文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csv_6" class="md-nav__link">
    <span class="md-ellipsis">
      写入CSV文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csv_7" class="md-nav__link">
    <span class="md-ellipsis">
      扫描CSV文件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2334-json-input" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.4 JSON input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    <span class="md-ellipsis">
      JSON 文件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JSON 文件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      读取
    </span>
  </a>
  
    <nav class="md-nav" aria-label="读取">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json_1" class="md-nav__link">
    <span class="md-ellipsis">
      标准 JSON
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json_2" class="md-nav__link">
    <span class="md-ellipsis">
      换行分隔的 JSON
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      写入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      扫描
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2335-polars-lazy-eager-api" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.5 Polars的急性和惰性模式 (Lazy / Eager API)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.3.5 Polars的急性和惰性模式 (Lazy / Eager API)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      急性模式示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      惰性模式示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      急性 API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      何时使用哪种模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      量化金融案例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="量化金融案例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sma" class="md-nav__link">
    <span class="md-ellipsis">
      急性模式示例：计算股票的简单移动平均线（SMA）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wma" class="md-nav__link">
    <span class="md-ellipsis">
      惰性模式示例：计算股票的加权移动平均线（WMA）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2336-streaming-mode" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.6 流模式 (Streaming Mode)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23.3.6 流模式 (Streaming Mode)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      流模式的关键特性：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      量化金融案例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="量化金融案例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api_1" class="md-nav__link">
    <span class="md-ellipsis">
      急性 API 示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api_2" class="md-nav__link">
    <span class="md-ellipsis">
      惰性 API 示例（带流模式）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      配置块大小
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      流模式的优势
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      使用流模式执行查询
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用流模式执行查询">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      何时可用流模式？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      示例（带支持操作）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      示例（带非流式操作）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2337-missihg-values" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.7 缺失值处理 Missihg Values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#null-nan" class="md-nav__link">
    <span class="md-ellipsis">
      null 和 NaN 值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      缺失数据元数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      填充缺失数据
    </span>
  </a>
  
    <nav class="md-nav" aria-label="填充缺失数据">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      使用指定字面值填充
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      使用策略填充
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      使用表达式填充
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      使用插值填充
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nan" class="md-nav__link">
    <span class="md-ellipsis">
      NaN 值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2338-window-functions" class="md-nav__link">
    <span class="md-ellipsis">
      23.3.8 窗口函数 Window functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      窗口函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="窗口函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      数据集示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      在选择上下文中的分组聚合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      每个分组内的操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    <span class="md-ellipsis">
      窗口表达式规则
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    <span class="md-ellipsis">
      更多示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#polarsdataframe" class="md-nav__link">
    <span class="md-ellipsis">
      案例：序列化 &amp; 转化为polars的dataframe
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="chapter-23-polars">Chapter 23 用Polars实现并加速数据框架处理<a class="headerlink" href="#chapter-23-polars" title="Permanent link">&para;</a></h1>
<h2 id="231-rustpolars">23.1 Rust与数据框架处理工具Polars<a class="headerlink" href="#231-rustpolars" title="Permanent link">&para;</a></h2>
<p>经过以上的学习，我们很自然地知道，Rust 的编译器通过严格的编译检查和优化，能够生成接近于手写汇编的高效代码。它的零成本抽象特性确保了高效的运行时性能，非常适合处理大量数据和计算密集型任务。同时，Rust 提供了独特的所有权系统和借用检查器，能够防止数据竞争和内存泄漏。这些特性使得开发者可以编写更安全的多线程数据处理代码，减少并发错误的发生。另外，Rust 的并发模型使得编写高效的并行代码变得更加简单和安全。通过使用 <code>Tokio</code> 等异步编程框架，开发者可以高效地处理大量并发任务，提升数据处理的吞吐量。所以使用 Rust 进行数据处理，结合其性能、安全性、并发支持和跨平台兼容性，我们能够构建出高效、可靠和灵活的数据处理工具，满足现代数据密集型应用的需求。本节将以Poars为例教读者如何实现并加速数据框架处理。</p>
<h3 id="polars">Polars 简介<a class="headerlink" href="#polars" title="Permanent link">&para;</a></h3>
<p>Polars 起初是一个在2020年作为爱好项目开始的开源库，但很快在开源社区中获得了广泛关注。许多开发者一直在寻找一个既易用又高性能的 DataFrame 库，Polars 正是为了填补这一空缺而出现的。随着越来越多来自不同背景和编程语言的贡献者加入，Polars 社区迅速壮大。由于社区的巨大努力，Polars 现在正式支持三种语言（Rust、Python、JS），并计划支持两种新的语言（R、Ruby）。</p>
<h3 id="_1">哲学理念<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>Polars 的目标是提供一个极速的 DataFrame 库，其特点包括：</p>
<ul>
<li>利用机器上的所有可用核心。</li>
<li>优化查询以减少不必要的工作和内存分配。</li>
<li>处理比可用内存更大的数据集。</li>
<li>提供一致且可预测的 API。</li>
<li>遵循严格的模式（在运行查询前应已知数据类型）。</li>
</ul>
<p>Polars 使用 Rust 编写，具有 C/C++ 的性能，并能完全控制查询引擎中性能关键的部分。</p>
<h3 id="_2">主要功能<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>快速</strong>：从头开始用 Rust 编写，设计紧贴机器且无外部依赖。</li>
<li><strong>I/O 支持</strong>：对本地、云存储和数据库的所有常见数据存储层提供一流支持。</li>
<li><strong>直观的 API</strong>：以自然的方式编写查询，Polars 内部会通过查询优化器确定最有效的执行方式。</li>
<li><strong>Out of Core</strong>：流式 API 允许处理结果时不需要将所有数据同时加载到内存中。</li>
<li><strong>并行处理</strong>：利用多核 CPU，无需额外配置即可分配工作负载。</li>
<li><strong>向量化查询引擎</strong>：使用 Apache Arrow 列式数据格式，以向量化方式处理查询，优化 CPU 使用。</li>
<li><strong>LazyMode</strong>：支持延迟计算模式，通过链式调用优化性能和资源使用。</li>
<li><strong>PyO3 支持</strong>：通过 PyO3 提供对 Python 的强大支持，使研究人员可以方便地使用 Python 进行数据分析。</li>
</ul>
<p>在接下来的章节中，我们会频繁接触到这些Polars先进的特性。</p>
<h3 id="rust">Rust 中的数据处理框架<a class="headerlink" href="#rust" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>DataFusion</strong>：DataFusion 是一个用于查询和数据处理的高性能查询引擎，支持 SQL 查询语法，并能够与 Arrow 格式的数据无缝集成，适用于大规模数据处理和分析。</li>
<li><strong>Arrow</strong>：Apache Arrow 是一个跨语言的开发平台，旨在实现高性能的列式内存格式，支持高效的数据序列化和反序列化操作，广泛应用于大数据处理和数据分析领域。</li>
</ol>
<p>这些其他也框架各有特点，为 Rust 开发者提供了丰富的数据处理和分析工具，能够满足不同的应用需求。</p>
<h2 id="232-polars">23.2 开始使用Polars<a class="headerlink" href="#232-polars" title="Permanent link">&para;</a></h2>
<h3 id="2321-polars">23.2.1 为项目加入polars库<a class="headerlink" href="#2321-polars" title="Permanent link">&para;</a></h3>
<p>本章节旨在帮助您开始使用 Polars。它涵盖了该库的所有基本功能和特性，使新用户能够轻松熟悉从初始安装和设置到核心功能的基础知识。如果您已经是高级用户或熟悉 DataFrame，您可以跳过本章节，直接进入下一个章节了解安装选项。</p>
<div class="language-toml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># 为项目加入polars库并且打开 &#39;lazy&#39; flag</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">cargo</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">polars</span><span class="w"> </span><span class="n">-F</span><span class="w"> </span><span class="n">lazy</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># Or Cargo.toml</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">[dependencies]</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">polars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">features</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;lazy&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">...]}</span>
</span></code></pre></div>
<h3 id="2322">23.2.2 读取与写入<a class="headerlink" href="#2322" title="Permanent link">&para;</a></h3>
<p>Polars 支持读取和写入常见文件格式（如 csv、json、parquet）、云存储（S3、Azure Blob、BigQuery）和数据库（如 postgres、mysql）。以下示例展示了在磁盘上读取和写入的概念。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">File</span><span class="p">;</span><span class="w"> </span><span class="c1">// 导入文件系统模块</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="k">use</span><span class="w"> </span><span class="n">chrono</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span><span class="w"> </span><span class="c1">// 导入 Chrono 时间库</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span><span class="w"> </span><span class="c1">// 导入 Polars 库</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1">// 创建一个 DataFrame，包含四列数据：整数、日期、浮点数和字符串</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">df</span><span class="p">:</span><span class="w"> </span><span class="nc">DataFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="s">&quot;integer&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="c1">// 整数列</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span><span class="s">&quot;date&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="w"> </span><span class="c1">// 日期列</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd_opt</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="n">unwrap</span><span class="p">().</span><span class="n">and_hms_opt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">unwrap</span><span class="p">(),</span><span class="w"> </span><span class="c1">// 第一天</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd_opt</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">).</span><span class="n">unwrap</span><span class="p">().</span><span class="n">and_hms_opt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">unwrap</span><span class="p">(),</span><span class="w"> </span><span class="c1">// 第二天</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd_opt</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">).</span><span class="n">unwrap</span><span class="p">().</span><span class="n">and_hms_opt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">unwrap</span><span class="p">(),</span><span class="w"> </span><span class="c1">// 第三天</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span><span class="s">&quot;float&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="mf">6.0</span><span class="p">],</span><span class="w"> </span><span class="c1">// 浮点数列</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">    </span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">],</span><span class="w"> </span><span class="c1">// 字符串列</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="p">)</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span><span class="w"> </span><span class="c1">// 创建 DataFrame 成功后，解除 Result 包装</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="c1">// 打印 DataFrame 的内容</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<p>这段代码展示了如何使用 Polars 在 Rust 中创建一个 DataFrame 并打印其内容。DataFrame 包含四列数据，分别是整数、日期、浮点数和字符串。通过这种方式，开发者可以方便地处理和分析数据。</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>shape: (3, 4)
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>┌─────────┬─────────────────────┬───────┬────────┐
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>│ integer ┆ date                ┆ float ┆ string │
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>│ ---     ┆ ---                 ┆ ---   ┆ ---    │
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>│ i64     ┆ datetime[μs]        ┆ f64   ┆ str    │
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>╞═════════╪═════════════════════╪═══════╪════════╡
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>│ 1       ┆ 2025-01-01 00:00:00 ┆ 4.0   ┆ a      │
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>│ 2       ┆ 2025-01-02 00:00:00 ┆ 5.0   ┆ b      │
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>│ 3       ┆ 2025-01-03 00:00:00 ┆ 6.0   ┆ c      │
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>└─────────┴─────────────────────┴───────┴────────┘
</span></code></pre></div>
<h3 id="2323-polars">23.2.3 Polars 表达式<a class="headerlink" href="#2323-polars" title="Permanent link">&para;</a></h3>
<p>Polars 的表达式是其核心优势之一，提供了模块化结构，使得简单概念可以组合成复杂查询。以下是构建所有查询的基本组件：</p>
<ul>
<li><code>select</code></li>
<li><code>filter</code></li>
<li><code>with_columns</code></li>
<li><code>group_by</code></li>
</ul>
<p>要了解更多关于表达式和它们操作的上下文，请参阅用户指南中的上下文和表达式部分。</p>
<h4 id="23231-select">23.2.3.1 选择（Select）<a class="headerlink" href="#23231-select" title="Permanent link">&para;</a></h4>
<p>选择一列数据需要做两件事：</p>
<ol>
<li>定义我们要获取数据的 DataFrame。</li>
<li>选择所需的数据。</li>
</ol>
<p>在下面的示例中，我们选择 <code>col('*')</code>，星号代表所有列。</p>
<h4 id="rust_1">Rust 示例代码<a class="headerlink" href="#rust_1" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="c1">// 假设 df 是已创建的 DataFrame</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">lazy</span><span class="p">().</span><span class="n">select</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">)]).</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>shape: (5, 4)
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>┌─────┬──────────┬─────────────────────┬───────┐
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>│ a   ┆ b        ┆ c                   ┆ d     │
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>│ --- ┆ ---      ┆ ---                 ┆ ---   │
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>│ i64 ┆ f64      ┆ datetime[μs]        ┆ f64   │
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>╞═════╪══════════╪═════════════════════╪═══════╡
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>│ 0   ┆ 0.10666  ┆ 2025-12-01 00:00:00 ┆ 1.0   │
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>│ 1   ┆ 0.596863 ┆ 2025-12-02 00:00:00 ┆ 2.0   │
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>│ 2   ┆ 0.691304 ┆ 2025-12-03 00:00:00 ┆ NaN   │
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>│ 3   ┆ 0.906636 ┆ 2025-12-04 00:00:00 ┆ -42.0 │
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>│ 4   ┆ 0.101216 ┆ 2025-12-05 00:00:00 ┆ null  │
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>└─────┴──────────┴─────────────────────┴───────┘
</span></code></pre></div>
<p>你也可以指定要返回的特定列，以下是传递列名的方式。</p>
<h4 id="rust_2">Rust 示例代码<a class="headerlink" href="#rust_2" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">lazy</span><span class="p">().</span><span class="n">select</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)]).</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>shape: (5, 2)
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>┌─────┬──────────┐
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>│ a   ┆ b        │
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>│ --- ┆ ---      │
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>│ i64 ┆ f64      │
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>╞═════╪══════════╡
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>│ 0   ┆ 0.10666  │
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>│ 1   ┆ 0.596863 │
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>│ 2   ┆ 0.691304 │
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>│ 3   ┆ 0.906636 │
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>│ 4   ┆ 0.101216 │
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>└─────┴──────────┘
</span></code></pre></div>
<h4 id="23232-filter">23.2.3.2 过滤（Filter）<a class="headerlink" href="#23232-filter" title="Permanent link">&para;</a></h4>
<p>过滤选项允许我们创建 DataFrame 的子集。我们使用之前的 DataFrame，并在两个指定日期之间进行过滤。</p>
<h4 id="rust_3">Rust 示例代码<a class="headerlink" href="#rust_3" title="Permanent link">&para;</a></h4>
<p>下面的示例展示了如何使用 Polars 和 Rust 进行数据过滤操作。我们将基于两个指定日期对 DataFrame 进行过滤。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">use</span><span class="w"> </span><span class="n">chrono</span><span class="p">::</span><span class="n">NaiveDate</span><span class="p">;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">start_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">).</span><span class="n">and_hms</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// 定义开始日期</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="kd">let</span><span class="w"> </span><span class="n">end_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">).</span><span class="n">and_hms</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">   </span><span class="c1">// 定义结束日期</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">lazy</span><span class="p">().</span><span class="n">filter</span><span class="p">(</span><span class="w"> </span><span class="c1">// 创建 DataFrame 的一个副本，并进入惰性计算模式</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">).</span><span class="n">gt_eq</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="n">start_date</span><span class="p">))</span><span class="w"> </span><span class="c1">// 过滤条件：列 &quot;c&quot; 的值大于等于开始日期</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="p">.</span><span class="n">and</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">).</span><span class="n">lt_eq</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="n">end_date</span><span class="p">)))</span><span class="w"> </span><span class="c1">// 过滤条件：列 &quot;c&quot; 的值小于等于结束日期</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="p">).</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// 收集结果并执行计算</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span><span class="w"> </span><span class="c1">// 打印过滤后的 DataFrame</span>
</span></code></pre></div>
<p>**注意。**在这里<code>lit()</code> 全称是 <code>literal</code>。在 Polars 中，<code>lit()</code> 函数用于将一个常量值转换为 Polars 表达式，使其可以在查询中使用。</p>
<p>示例代码的输出示例如下：</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>shape: (2, 4)
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>┌─────┬──────────┬─────────────────────┬─────┐
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>│ a   ┆ b        ┆ c                   ┆ d   │
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>│ --- ┆ ---      ┆ ---                 ┆ --- │
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>│ i64 ┆ f64      ┆ datetime[μs]        ┆ f64 │
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>╞═════╪══════════╪═════════════════════╪═════╡
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>│ 1   ┆ 0.596863 ┆ 2025-12-02 00:00:00 ┆ 2.0 │
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>│ 2   ┆ 0.691304 ┆ 2025-12-03 00:00:00 ┆ NaN │
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>└─────┴──────────┴─────────────────────┴─────┘
</span></code></pre></div>
<p>你还可以创建包含多个列的更复杂的过滤器。</p>
<h4 id="rust_4">Rust 示例代码<a class="headerlink" href="#rust_4" title="Permanent link">&para;</a></h4>
<p>下面的示例展示了如何使用 Polars 和 Rust 进行数据过滤操作。我们将基于一个条件对 DataFrame 进行过滤。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">lazy</span><span class="p">().</span><span class="n">filter</span><span class="p">(</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">).</span><span class="n">lt_eq</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="c1">// 过滤条件：列 &quot;a&quot; 的值小于或等于 3</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="p">.</span><span class="n">and</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;d&quot;</span><span class="p">).</span><span class="n">is_not_null</span><span class="p">())</span><span class="w"> </span><span class="c1">// 过滤条件：列 &quot;d&quot; 的值不是空值</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="p">).</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// 收集结果并执行计算</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span><span class="w"> </span><span class="c1">// 打印过滤后的 DataFrame</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>shape: (3, 4)
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>┌─────┬──────────┬─────────────────────┬───────┐
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>│ a   ┆ b        ┆ c                   ┆ d     │
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>│ --- ┆ ---      ┆ ---                 ┆ ---   │
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>│ i64 ┆ f64      ┆ datetime[μs]        ┆ f64   │
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>╞═════╪══════════╪═════════════════════╪═══════╡
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>│ 0   ┆ 0.10666  ┆ 2025-12-01 00:00:00 ┆ 1.0   │
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>│ 1   ┆ 0.596863 ┆ 2025-12-02 00:00:00 ┆ 2.0   │
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>│ 3   ┆ 0.906636 ┆ 2025-12-04 00:00:00 ┆ -42.0 │
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>└─────┴──────────┴─────────────────────┴───────┘
</span></code></pre></div>
<h4 id="23233-add-columns">23.2.3.3 添加列（Add Columns）<a class="headerlink" href="#23233-add-columns" title="Permanent link">&para;</a></h4>
<p><code>with_columns</code> 允许你为分析创建新列。我们将创建两个新列 <code>e</code> 和 <code>b+42</code>。首先，我们将列 <code>b</code> 的所有值求和并存储在新列 <code>e</code> 中。然后我们将列 <code>b</code> 的值加上 42，并将结果存储在新列 <code>b+42</code> 中。</p>
<h4 id="rust_5">Rust 示例代码<a class="headerlink" href="#rust_5" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="c1">// 创建新的列</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span><span class="w"> </span><span class="c1">// 克隆 DataFrame</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span><span class="w"> </span><span class="c1">// 进入惰性计算模式</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="p">.</span><span class="n">with_columns</span><span class="p">([</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">        </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">).</span><span class="n">sum</span><span class="p">().</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// 新列 e：列 b 的所有值求和</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">        </span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lit</span><span class="p">(</span><span class="mi">42</span><span class="p">)).</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;b+42&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// 新列 b+42：列 b 的值加 42</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">    </span><span class="p">])</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// 收集结果并执行计算</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span><span class="w"> </span><span class="c1">// 打印结果</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>shape: (5, 6)
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>┌─────┬──────────┬─────────────────────┬───────┬──────────┬───────────┐
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>│ a   ┆ b        ┆ c                   ┆ d     ┆ e        ┆ b+42      │
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>│ --- ┆ ---      ┆ ---                 ┆ ---   ┆ ---      ┆ ---       │
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>│ i64 ┆ f64      ┆ datetime[μs]        ┆ f64   ┆ f64      ┆ f64       │
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>╞═════╪══════════╪═════════════════════╪═══════╪══════════╪═══════════╡
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>│ 0   ┆ 0.10666  ┆ 2025-12-01 00:00:00 ┆ 1.0   ┆ 2.402679 ┆ 42.10666  │
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>│ 1   ┆ 0.596863 ┆ 2025-12-02 00:00:00 ┆ 2.0   ┆ 2.402679 ┆ 42.596863 │
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>│ 2   ┆ 0.691304 ┆ 2025-12-03 00:00:00 ┆ NaN   ┆ 2.402679 ┆ 42.691304 │
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>│ 3   ┆ 0.906636 ┆ 2025-12-04 00:00:00 ┆ -42.0 ┆ 2.402679 ┆ 42.906636 │
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>│ 4   ┆ 0.101216 ┆ 2025-12-05 00:00:00 ┆ null  ┆ 2.402679 ┆ 42.101216 │
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>└─────┴──────────┴─────────────────────┴───────┴──────────┴───────────┘
</span></code></pre></div>
<h4 id="23234-group-by">23.2.3.4 分组（Group by）<a class="headerlink" href="#23234-group-by" title="Permanent link">&para;</a></h4>
<p>我们将创建一个新的 DataFrame 来演示分组功能。这个新的 DataFrame 包含多个“组”，我们将按这些组进行分组。</p>
<h4 id="dataframe">创建 DataFrame<a class="headerlink" href="#dataframe" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="c1">// 创建 DataFrame</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">df2</span><span class="p">:</span><span class="w"> </span><span class="nc">DataFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y&quot;</span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;X&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;X&quot;</span><span class="p">]).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;should not fail&quot;</span><span class="p">);</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df2</span><span class="p">);</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>shape: (8, 2)
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>┌─────┬─────┐
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>│ x   ┆ y   │
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>│ --- ┆ --- │
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>│ i64 ┆ str │
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>╞═════╪═════╡
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>│ 0   ┆ A   │
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>│ 1   ┆ A   │
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>│ 2   ┆ A   │
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>│ 3   ┆ B   │
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>│ 4   ┆ B   │
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>│ 5   ┆ C   │
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>│ 6   ┆ X   │
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>│ 7   ┆ X   │
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>└─────┴─────┘
</span></code></pre></div>
<h4 id="_3">分组并聚合<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="c1">// 按列 &quot;y&quot; 进行分组，并聚合</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df2</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">lazy</span><span class="p">().</span><span class="n">group_by</span><span class="p">([</span><span class="s">&quot;y&quot;</span><span class="p">]).</span><span class="n">agg</span><span class="p">([</span><span class="n">len</span><span class="p">()]).</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>shape: (4, 2)
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>┌─────┬─────┐
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>│ y   ┆ len │
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>│ --- ┆ --- │
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>│ str ┆ u32 │
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>╞═════╪═════╡
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>│ A   ┆ 3   │
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>│ B   ┆ 2   │
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>│ C   ┆ 1   │
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>│ X   ┆ 2   │
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>└─────┴─────┘
</span></code></pre></div>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="c1">// 按列 &quot;y&quot; 进行分组，并聚合多个统计量</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df2</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">    </span><span class="p">.</span><span class="n">group_by</span><span class="p">([</span><span class="s">&quot;y&quot;</span><span class="p">])</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">    </span><span class="p">.</span><span class="n">agg</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">).</span><span class="n">count</span><span class="p">().</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;count&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">).</span><span class="n">sum</span><span class="p">().</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;sum&quot;</span><span class="p">)])</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>shape: (4, 3)
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>┌─────┬───────┬─────┐
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>│ y   ┆ count ┆ sum │
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>│ --- ┆ ---   ┆ --- │
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>│ str ┆ u32   ┆ i64 │
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>╞═════╪═══════╪═════╡
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>│ A   ┆ 3     ┆ 3   │
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>│ B   ┆ 2     ┆ 7   │
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>│ C   ┆ 1     ┆ 5   │
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>│ X   ┆ 2     ┆ 13  │
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>└─────┴───────┴─────┘
</span></code></pre></div>
<h4 id="23235">23.2.3.5 组合操作<a class="headerlink" href="#23235" title="Permanent link">&para;</a></h4>
<p>以下示例展示了如何组合操作来创建所需的 DataFrame。</p>
<h4 id="cd">创建并选择列（排除c、d列）<a class="headerlink" href="#cd" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="c1">// 创建新列并选择</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">    </span><span class="p">.</span><span class="n">with_columns</span><span class="p">([(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)).</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;a * b&quot;</span><span class="p">)])</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">    </span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">).</span><span class="n">exclude</span><span class="p">([</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;d&quot;</span><span class="p">])])</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>shape: (5, 3)
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>┌─────┬──────────┬──────────┐
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>│ a   ┆ b        ┆ a * b    │
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>│ --- ┆ ---      ┆ ---      │
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>│ i64 ┆ f64      ┆ f64      │
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>╞═════╪══════════╪══════════╡
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>│ 0   ┆ 0.10666  ┆ 0.0      │
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>│ 1   ┆ 0.596863 ┆ 0.596863 │
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>│ 2   ┆ 0.691304 ┆ 1.382607 │
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>│ 3   ┆ 0.906636 ┆ 2.719909 │
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>│ 4   ┆ 0.101216 ┆ 0.404864 │
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>└─────┴──────────┴──────────┘
</span></code></pre></div>
<h4 id="d">创建并选择列（排除d列）<a class="headerlink" href="#d" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="c1">// 创建新列并选择</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">    </span><span class="p">.</span><span class="n">with_columns</span><span class="p">([(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)).</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;a * b&quot;</span><span class="p">)])</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">    </span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">).</span><span class="n">exclude</span><span class="p">([</span><span class="s">&quot;d&quot;</span><span class="p">])])</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>shape: (5, 4)
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>┌─────┬──────────┬─────────────────────┬──────────┐
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>│ a   ┆ b        ┆ c                   ┆ a * b    │
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>│ --- ┆ ---      ┆ ---                 ┆ ---      │
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>│ i64 ┆ f64      ┆ datetime[μs]        ┆ f64      │
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>╞═════╪══════════╪═════════════════════╪══════════╡
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>│ 0   ┆ 0.10666  ┆ 2025-12-01 00:00:00 ┆ 0.0      │
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>│ 1   ┆ 0.596863 ┆ 2025-12-02 00:00:00 ┆ 0.596863 │
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>│ 2   ┆ 0.691304 ┆ 2025-12-03 00:00:00 ┆ 1.382607 │
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>│ 3   ┆ 0.906636 ┆ 2025-12-04 00:00:00 ┆ 2.719909 │
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>│ 4   ┆ 0.101216 ┆ 2025-12-05 00:00:00 ┆ 0.404864 │
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>└─────┴──────────┴─────────────────────┴──────────┘
</span></code></pre></div>
<h3 id="2324-dataframes">23.2.4 合并 DataFrames<a class="headerlink" href="#2324-dataframes" title="Permanent link">&para;</a></h3>
<p>根据使用情况，DataFrames 可以通过两种方式进行合并：<code>join</code> 和 <code>concat</code>。</p>
<h4 id="23241-join">23.2.4.1 连接（Join）<a class="headerlink" href="#23241-join" title="Permanent link">&para;</a></h4>
<h4 id="_4">数据表连接类型详解<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<p>在数据分析中，连接（Join）操作用于将两个 DataFrames 合并。Polars 支持多种连接类型，包括左连接（Left Join）、右连接（Right Join）、内连接（Inner Join）和外连接（Outer Join）。以下是每种连接类型的详细介绍和示例。</p>
<h4 id="left-join">左连接（Left Join）<a class="headerlink" href="#left-join" title="Permanent link">&para;</a></h4>
<p>左连接返回左表中的所有行以及与右表中匹配的行。如果右表中没有匹配的行，则结果中的相应列为 NULL。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="k">use</span><span class="w"> </span><span class="n">rand</span><span class="p">::</span><span class="n">Rng</span><span class="p">;</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">rng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">::</span><span class="n">thread_rng</span><span class="p">();</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="kd">let</span><span class="w"> </span><span class="n">df1</span><span class="p">:</span><span class="w"> </span><span class="nc">DataFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">    </span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">8</span><span class="p">,</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">    </span><span class="s">&quot;b&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">8</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="n">rng</span><span class="p">.</span><span class="n">gen</span><span class="p">::</span><span class="o">&lt;</span><span class="kt">f64</span><span class="o">&gt;</span><span class="p">()).</span><span class="n">collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">f64</span><span class="o">&gt;&gt;</span><span class="p">()</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="kd">let</span><span class="w"> </span><span class="n">df2</span><span class="p">:</span><span class="w"> </span><span class="nc">DataFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">    </span><span class="s">&quot;x&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">8</span><span class="p">,</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">    </span><span class="s">&quot;y&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;X&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;X&quot;</span><span class="p">]</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="kd">let</span><span class="w"> </span><span class="n">joined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df1</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="o">&amp;</span><span class="n">df2</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">JoinType</span><span class="p">::</span><span class="n">Left</span><span class="p">.</span><span class="n">into</span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">joined</span><span class="p">);</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>shape: (8, 4)
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>┌─────┬──────────┬───────┬─────┐
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>│ a   ┆ b        ┆ x     ┆ y   │
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>│ --- ┆ ---      ┆ ---   ┆ --- │
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>│ i64 ┆ f64      ┆ i64   ┆ str │
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>╞═════╪══════════╪═══════╪═════╡
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>│ 0   ┆ 0.495791 ┆ 0     ┆ A   │
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>│ 1   ┆ 0.786293 ┆ 1     ┆ A   │
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>│ 2   ┆ 0.847485 ┆ 2     ┆ A   │
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>│ 3   ┆ 0.839398 ┆ 3     ┆ B   │
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>│ 4   ┆ 0.060646 ┆ 4     ┆ B   │
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>│ 5   ┆ 0.251472 ┆ 5     ┆ C   │
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>│ 6   ┆ 0.13899  ┆ 6     ┆ X   │
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>│ 7   ┆ 0.676241 ┆ 7     ┆ X   │
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>└─────┴──────────┴───────┴─────┘
</span></code></pre></div>
<h4 id="right-join">右连接（Right Join）<a class="headerlink" href="#right-join" title="Permanent link">&para;</a></h4>
<p>右连接返回右表中的所有行以及与左表中匹配的行。如果左表中没有匹配的行，则结果中的相应列为 NULL。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">joined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df1</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="o">&amp;</span><span class="n">df2</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">JoinType</span><span class="p">::</span><span class="n">Right</span><span class="p">.</span><span class="n">into</span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">joined</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="inner-join">内连接（Inner Join）<a class="headerlink" href="#inner-join" title="Permanent link">&para;</a></h4>
<p>内连接仅返回两个表中匹配的行。如果没有匹配的行，则该行不出现在结果中。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">joined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df1</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="o">&amp;</span><span class="n">df2</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">JoinType</span><span class="p">::</span><span class="n">Inner</span><span class="p">.</span><span class="n">into</span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">joined</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="outer-join">外连接（Outer Join）<a class="headerlink" href="#outer-join" title="Permanent link">&para;</a></h4>
<p>外连接返回两个表中的所有行。如果一张表中没有匹配的行，则结果中的相应列为 NULL。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">joined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df1</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="o">&amp;</span><span class="n">df2</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">JoinType</span><span class="p">::</span><span class="n">Outer</span><span class="p">.</span><span class="n">into</span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">joined</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="_5">示例代码解释<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>数据生成</strong>：</li>
</ol>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">df1</span><span class="p">:</span><span class="w"> </span><span class="nc">DataFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">8</span><span class="p">,</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span><span class="s">&quot;b&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">8</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="n">rng</span><span class="p">.</span><span class="n">gen</span><span class="p">::</span><span class="o">&lt;</span><span class="kt">f64</span><span class="o">&gt;</span><span class="p">()).</span><span class="n">collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">f64</span><span class="o">&gt;&gt;</span><span class="p">()</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="kd">let</span><span class="w"> </span><span class="n">df2</span><span class="p">:</span><span class="w"> </span><span class="nc">DataFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">    </span><span class="s">&quot;x&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">8</span><span class="p">,</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">    </span><span class="s">&quot;y&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;X&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;X&quot;</span><span class="p">]</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span></code></pre></div>
<p>这段代码创建了两个 DataFrames，<code>df1</code> 包含列 <code>a</code> 和 <code>b</code>，<code>df2</code> 包含列 <code>x</code> 和 <code>y</code>。</p>
<ol>
<li><strong>连接操作</strong>：</li>
</ol>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">joined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df1</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="o">&amp;</span><span class="n">df2</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">JoinType</span><span class="p">::</span><span class="n">Left</span><span class="p">.</span><span class="n">into</span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">joined</span><span class="p">);</span>
</span></code></pre></div>
<p>这段代码执行了左连接，结果包含 <code>df1</code> 中的所有行以及 <code>df2</code> 中匹配的行。</p>
<p>通过这些示例，你可以更好地理解如何在 Rust 中使用 Polars 进行不同类型的连接操作。</p>
<h4 id="23242-concat">23.2.4.2 粘连（Concat）<a class="headerlink" href="#23242-concat" title="Permanent link">&para;</a></h4>
<p>我们也可以粘连两个 DataFrames。垂直粘连会使 DataFrame 变长，水平粘连会使 DataFrame 变宽。以下示例展示了水平粘连两个 DataFrames 的结果。</p>
<h4 id="rust_6">Rust 示例代码<a class="headerlink" href="#rust_6" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="c1">// 水平连接两个 DataFrames</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">stacked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">df2</span><span class="p">.</span><span class="n">get_columns</span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">stacked</span><span class="p">);</span><span class="w"> </span><span class="c1">// 打印连接后的 DataFrame</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>shape: (8, 5)
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>┌─────┬──────────┬───────┬─────┬─────┐
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>│ a   ┆ b        ┆ d     ┆ x   ┆ y   │
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>│ --- ┆ ---      ┆ ---   ┆ --- ┆ --- │
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>│ i64 ┆ f64      ┆ f64   ┆ i64 ┆ str │
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>╞═════╪══════════╪═══════╪═════╪═════╡
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>│ 0   ┆ 0.495791 ┆ 1.0   ┆ 0   ┆ A   │
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>│ 1   ┆ 0.786293 ┆ 2.0   ┆ 1   ┆ A   │
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>│ 2   ┆ 0.847485 ┆ NaN   ┆ 2   ┆ A   │
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>│ 3   ┆ 0.839398 ┆ NaN   ┆ 3   ┆ B   │
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>│ 4   ┆ 0.060646 ┆ 0.0   ┆ 4   ┆ B   │
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>│ 5   ┆ 0.251472 ┆ -5.0  ┆ 5   ┆ C   │
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>│ 6   ┆ 0.13899  ┆ -42.0 ┆ 6   ┆ X   │
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>│ 7   ┆ 0.676241 ┆ null  ┆ 7   ┆ X   │
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>└─────┴──────────┴───────┴─────┴─────┘
</span></code></pre></div>
<p>通过上述学习，你可以在 Rust 中使用 Polars 方便地进行 DataFrame 的连接和粘连。</p>
<h3 id="2325">23.2.5 基本数据类型<a class="headerlink" href="#2325" title="Permanent link">&para;</a></h3>
<p>Polars 完全基于 Arrow 数据类型，并由 Arrow 内存数组支持。这使得数据处理缓存效率高，并且支持进程间通信。大多数数据类型完全遵循 Arrow 的实现，除了 String（实际上是 LargeUtf8）、Categorical 和 Object（支持有限）。数据类型如下：</p>
<h4 id="_6">数值类型<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<ul>
<li>Int8：8 位有符号整数。</li>
<li>Int16：16 位有符号整数。</li>
<li>Int32：32 位有符号整数。</li>
<li>Int64：64 位有符号整数。</li>
<li>UInt8：8 位无符号整数。</li>
<li>UInt16：16 位无符号整数。</li>
<li>UInt32：32 位无符号整数。</li>
<li>UInt64：64 位无符号整数。</li>
<li>Float32：32 位浮点数。</li>
<li>Float64：64 位浮点数。</li>
</ul>
<h4 id="_7">嵌套类型<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<ul>
<li>Struct：结构体数组，表示为 <code>Vec&lt;Series&gt;</code>，用于在单列中打包多个/异质值。</li>
<li>List：列表数组，包含一个子数组和一个偏移数组（实际上是 Arrow LargeList）。</li>
</ul>
<h4 id="_8">时间类型<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h4>
<ul>
<li>Date：日期表示，内部表示为自 UNIX 纪元以来的天数，编码为 32 位有符号整数。</li>
<li>Datetime：日期时间表示，内部表示为自 UNIX 纪元以来的微秒数，编码为 64 位有符号整数。</li>
<li>Duration：时间间隔类型，内部表示为微秒。由 Date/Datetime 相减生成。</li>
<li>Time：时间表示，内部表示为自午夜以来的纳秒数。</li>
</ul>
<h4 id="_9">其他类型<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<ul>
<li>Boolean：布尔类型，有效位打包。</li>
<li>String：字符串数据（实际上是 Arrow LargeUtf8）。</li>
<li>Binary：存储为字节的数据。</li>
<li>Object：有限支持的数据类型，可以是任何值。</li>
<li>Categorical：字符串集合的分类编码。</li>
<li>Enum：字符串集合的固定分类编码。</li>
</ul>
<h4 id="_10">浮点数<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<p>Polars 通常遵循 IEEE 754 浮点标准用于 Float32 和 Float64，但有一些例外：</p>
<ul>
<li>任何 NaN 与任何其他 NaN 比较时相等，并且大于任何非 NaN 值。</li>
<li>操作不保证零或 NaN 的符号，也不保证 NaN 值的有效负载。这不仅限于算术运算，例如排序或分组操作可能将所有零规范化为 +0，将所有 NaNs 规范化为没有负载的正 NaN，以便高效的相等性检查。</li>
</ul>
<p>Polars 始终尝试提供合理准确的浮点计算结果，但除非另有说明，否则不保证误差。通常 100% 准确的结果获取代价高昂（需要比 64 位浮点数更大的内部表示），因此总会存在一些误差。</p>
<hr />
<h4 id="_11">示例<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h4>
<h4 id="_12">数值类型示例<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">    </span><span class="s">&quot;int8_col&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">1</span><span class="k">i8</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">    </span><span class="s">&quot;int16_col&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">100</span><span class="k">i16</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">],</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">    </span><span class="s">&quot;int32_col&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">1000</span><span class="k">i32</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="mi">3000</span><span class="p">],</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">    </span><span class="s">&quot;float64_col&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mf">1.1</span><span class="k">f64</span><span class="p">,</span><span class="w"> </span><span class="mf">2.2</span><span class="p">,</span><span class="w"> </span><span class="mf">3.3</span><span class="p">],</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="p">}.</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="_13">嵌套类型示例<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="s">&quot;list_col&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="fm">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">]],</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="p">}.</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="_14">时间类型示例<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="k">use</span><span class="w"> </span><span class="n">chrono</span><span class="p">::</span><span class="n">NaiveDate</span><span class="p">;</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">    </span><span class="s">&quot;date_col&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)],</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="p">}.</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<p>通过这些示例，你可以了解如何在 Rust 中使用 Polars 处理各种数据类型。</p>
<h3 id="2326">23.2.6 数据结构<a class="headerlink" href="#2326" title="Permanent link">&para;</a></h3>
<h4 id="_15">数据结构<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h4>
<p>Polars 提供的核心数据结构是 Series 和 DataFrame。</p>
<h5 id="series">Series<a class="headerlink" href="#series" title="Permanent link">&para;</a></h5>
<p>Series 是一维数据结构，其中所有元素具有相同的数据类型。以下代码展示了如何创建一个简单的 Series 对象：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="c1">// 创建名为 &quot;a&quot; 的 Series 对象</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Series</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">]);</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="c1">// 打印 Series 对象</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">);</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>shape: (5,)
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>Series: &#39;a&#39; [i64]
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>[
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>    1
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>    2
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>    3
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>    4
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>    5
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>]
</span></code></pre></div>
<h5 id="dataframe_1">DataFrame<a class="headerlink" href="#dataframe_1" title="Permanent link">&para;</a></h5>
<p>DataFrame 是由 Series 支持的二维数据结构，可以看作是一系列 Series 的抽象集合。可以对 DataFrame 执行类似 SQL 查询的操作，如 GROUP BY、JOIN、PIVOT 等，还可以定义自定义函数。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="k">use</span><span class="w"> </span><span class="n">chrono</span><span class="p">::</span><span class="n">NaiveDate</span><span class="p">;</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="c1">// 创建一个 DataFrame 对象</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="p">:</span><span class="w"> </span><span class="nc">DataFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="w">    </span><span class="s">&quot;integer&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">],</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="w">    </span><span class="s">&quot;date&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd_opt</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="n">unwrap</span><span class="p">().</span><span class="n">and_hms_opt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">unwrap</span><span class="p">(),</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd_opt</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">).</span><span class="n">unwrap</span><span class="p">().</span><span class="n">and_hms_opt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">unwrap</span><span class="p">(),</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd_opt</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">).</span><span class="n">unwrap</span><span class="p">().</span><span class="n">and_hms_opt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">unwrap</span><span class="p">(),</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd_opt</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">).</span><span class="n">unwrap</span><span class="p">().</span><span class="n">and_hms_opt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">unwrap</span><span class="p">(),</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd_opt</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">).</span><span class="n">unwrap</span><span class="p">().</span><span class="n">and_hms_opt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">unwrap</span><span class="p">(),</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a><span class="w">    </span><span class="s">&quot;float&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="mf">6.0</span><span class="p">,</span><span class="w"> </span><span class="mf">7.0</span><span class="p">,</span><span class="w"> </span><span class="mf">8.0</span><span class="p">]</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="p">)</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a><span class="c1">// 打印 DataFrame 对象</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>shape: (5, 3)
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>┌─────────┬─────────────────────┬───────┐
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>│ integer ┆ date                ┆ float │
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>│ ---     ┆ ---                 ┆ ---   │
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>│ i64     ┆ datetime[μs]        ┆ f64   │
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>╞═════════╪═════════════════════╪═══════╡
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>│ 1       ┆ 2022-01-01 00:00:00 ┆ 4.0   │
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>│ 2       ┆ 2022-01-02 00:00:00 ┆ 5.0   │
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>│ 3       ┆ 2022-01-03 00:00:00 ┆ 6.0   │
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>│ 4       ┆ 2022-01-04 00:00:00 ┆ 7.0   │
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>│ 5       ┆ 2022-01-05 00:00:00 ┆ 8.0   │
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>└─────────┴─────────────────────┴───────┘
</span></code></pre></div>
<h4 id="_16">查看数据<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h4>
<p>以下部分将介绍如何查看 DataFrame 中的数据。我们将使用前面的 DataFrame 作为示例。</p>
<h5 id="head">Head<a class="headerlink" href="#head" title="Permanent link">&para;</a></h5>
<p><code>head</code> 函数默认显示 DataFrame 的前 5 行。你可以指定要查看的行数（例如 <code>df.head(10)</code>）。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">df_head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="c1">// 打印前 3 行数据</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df_head</span><span class="p">);</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>shape: (3, 3)
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>┌─────────┬─────────────────────┬───────┐
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>│ integer ┆ date                ┆ float │
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>│ ---     ┆ ---                 ┆ ---   │
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>│ i64     ┆ datetime[μs]        ┆ f64   │
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>╞═════════╪═════════════════════╪═══════╡
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>│ 1       ┆ 2022-01-01 00:00:00 ┆ 4.0   │
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>│ 2       ┆ 2022-01-02 00:00:00 ┆ 5.0   │
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>│ 3       ┆ 2022-01-03 00:00:00 ┆ 6.0   │
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>└─────────┴─────────────────────┴───────┘
</span></code></pre></div>
<h5 id="tail">Tail<a class="headerlink" href="#tail" title="Permanent link">&para;</a></h5>
<p><code>tail</code> 函数显示 DataFrame 的最后 5 行。你也可以指定要查看的行数，类似于 <code>head</code>。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">df_tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">tail</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="c1">// 打印后 3 行数据</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df_tail</span><span class="p">);</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>shape: (3, 3)
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>┌─────────┬─────────────────────┬───────┐
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>│ integer ┆ date                ┆ float │
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>│ ---     ┆ ---                 ┆ ---   │
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>│ i64     ┆ datetime[μs]        ┆ f64   │
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>╞═════════╪═════════════════════╪═══════╡
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>│ 3       ┆ 2022-01-03 00:00:00 ┆ 6.0   │
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>│ 4       ┆ 2022-01-04 00:00:00 ┆ 7.0   │
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>│ 5       ┆ 2022-01-05 00:00:00 ┆ 8.0   │
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>└─────────┴─────────────────────┴───────┘
</span></code></pre></div>
<h5 id="sample">Sample<a class="headerlink" href="#sample" title="Permanent link">&para;</a></h5>
<p>如果你想随机查看 DataFrame 中的一些数据，你可以使用 <code>sample</code>。<code>sample</code> 可以从 DataFrame 中获取 n 行随机行。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Series</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">sampled_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">sample_n</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nb">None</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="c1">// 打印随机抽样的数据</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sampled_df</span><span class="p">);</span>
</span></code></pre></div>
<p>输出示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>shape: (2, 3)
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>┌─────────┬─────────────────────┬───────┐
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>│ integer ┆ date                ┆ float │
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>│ ---     ┆ ---                 ┆ ---   │
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>│ i64     ┆ datetime[μs]        ┆ f64   │
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>╞═════════╪═════════════════════╪═══════╡
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>│ 3       ┆ 2022-01-03 00:00:00 ┆ 6.0   │
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>│ 2       ┆ 2022-01-02 00:00:00 ┆ 5.0   │
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>└─────────┴─────────────────────┴───────┘
</span></code></pre></div>
<h5 id="describe">描述（Describe）<a class="headerlink" href="#describe" title="Permanent link">&para;</a></h5>
<p><code>describe</code> 返回 DataFrame 的摘要统计信息。如果可能，它将提供一些快速统计信息。</p>
<p>注意，很遗憾，在 Rust 中，这个功能目前不可用。</p>
<h2 id="233-polars">23.3 Polars进阶学习<a class="headerlink" href="#233-polars" title="Permanent link">&para;</a></h2>
<h3 id="2331-aggregation">23.3.1 聚合操作 Aggregation<a class="headerlink" href="#2331-aggregation" title="Permanent link">&para;</a></h3>
<h3 id="_17">聚合操作在量化金融中的应用<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p>Polars 实现了强大的语法，既可以在惰性 API 中定义，也可以在急性 API 中定义。让我们看一下这意味着什么。</p>
<p>我们可以从一个简单的期货和期权交易数据集开始。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Cursor</span><span class="p">;</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="k">use</span><span class="w"> </span><span class="n">reqwest</span><span class="p">::</span><span class="n">blocking</span><span class="p">::</span><span class="n">Client</span><span class="p">;</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="kd">let</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://example.com/financial-data.csv&quot;</span><span class="p">;</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Schema</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="n">schema</span><span class="p">.</span><span class="n">with_column</span><span class="p">(</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="w">    </span><span class="s">&quot;symbol&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="w">    </span><span class="n">DataType</span><span class="p">::</span><span class="n">Categorical</span><span class="p">(</span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Default</span><span class="p">::</span><span class="n">default</span><span class="p">()),</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="p">);</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="n">schema</span><span class="p">.</span><span class="n">with_column</span><span class="p">(</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="w">    </span><span class="s">&quot;type&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="w">    </span><span class="n">DataType</span><span class="p">::</span><span class="n">Categorical</span><span class="p">(</span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Default</span><span class="p">::</span><span class="n">default</span><span class="p">()),</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="p">);</span>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="n">schema</span><span class="p">.</span><span class="n">with_column</span><span class="p">(</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="w">    </span><span class="s">&quot;trade_date&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a><span class="w">    </span><span class="n">DataType</span><span class="p">::</span><span class="n">Date</span><span class="p">,</span>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="p">);</span>
</span><span id="__span-45-20"><a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a><span class="n">schema</span><span class="p">.</span><span class="n">with_column</span><span class="p">(</span>
</span><span id="__span-45-21"><a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a><span class="w">    </span><span class="s">&quot;open&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span>
</span><span id="__span-45-22"><a id="__codelineno-45-22" name="__codelineno-45-22" href="#__codelineno-45-22"></a><span class="w">    </span><span class="n">DataType</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span>
</span><span id="__span-45-23"><a id="__codelineno-45-23" name="__codelineno-45-23" href="#__codelineno-45-23"></a><span class="p">);</span>
</span><span id="__span-45-24"><a id="__codelineno-45-24" name="__codelineno-45-24" href="#__codelineno-45-24"></a><span class="n">schema</span><span class="p">.</span><span class="n">with_column</span><span class="p">(</span>
</span><span id="__span-45-25"><a id="__codelineno-45-25" name="__codelineno-45-25" href="#__codelineno-45-25"></a><span class="w">    </span><span class="s">&quot;close&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span>
</span><span id="__span-45-26"><a id="__codelineno-45-26" name="__codelineno-45-26" href="#__codelineno-45-26"></a><span class="w">    </span><span class="n">DataType</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span>
</span><span id="__span-45-27"><a id="__codelineno-45-27" name="__codelineno-45-27" href="#__codelineno-45-27"></a><span class="p">);</span>
</span><span id="__span-45-28"><a id="__codelineno-45-28" name="__codelineno-45-28" href="#__codelineno-45-28"></a><span class="n">schema</span><span class="p">.</span><span class="n">with_column</span><span class="p">(</span>
</span><span id="__span-45-29"><a id="__codelineno-45-29" name="__codelineno-45-29" href="#__codelineno-45-29"></a><span class="w">    </span><span class="s">&quot;volume&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span>
</span><span id="__span-45-30"><a id="__codelineno-45-30" name="__codelineno-45-30" href="#__codelineno-45-30"></a><span class="w">    </span><span class="n">DataType</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span>
</span><span id="__span-45-31"><a id="__codelineno-45-31" name="__codelineno-45-31" href="#__codelineno-45-31"></a><span class="p">);</span>
</span><span id="__span-45-32"><a id="__codelineno-45-32" name="__codelineno-45-32" href="#__codelineno-45-32"></a>
</span><span id="__span-45-33"><a id="__codelineno-45-33" name="__codelineno-45-33" href="#__codelineno-45-33"></a><span class="kd">let</span><span class="w"> </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Client</span><span class="p">::</span><span class="n">new</span><span class="p">().</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="n">send</span><span class="p">()</span><span class="o">?</span><span class="p">.</span><span class="n">text</span><span class="p">()</span><span class="o">?</span><span class="p">.</span><span class="n">bytes</span><span class="p">().</span><span class="n">collect</span><span class="p">();</span>
</span><span id="__span-45-34"><a id="__codelineno-45-34" name="__codelineno-45-34" href="#__codelineno-45-34"></a>
</span><span id="__span-45-35"><a id="__codelineno-45-35" name="__codelineno-45-35" href="#__codelineno-45-35"></a><span class="kd">let</span><span class="w"> </span><span class="n">dataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CsvReadOptions</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
</span><span id="__span-45-36"><a id="__codelineno-45-36" name="__codelineno-45-36" href="#__codelineno-45-36"></a><span class="w">    </span><span class="p">.</span><span class="n">with_has_header</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-45-37"><a id="__codelineno-45-37" name="__codelineno-45-37" href="#__codelineno-45-37"></a><span class="w">    </span><span class="p">.</span><span class="n">with_schema</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="n">Arc</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">schema</span><span class="p">)))</span>
</span><span id="__span-45-38"><a id="__codelineno-45-38" name="__codelineno-45-38" href="#__codelineno-45-38"></a><span class="w">    </span><span class="p">.</span><span class="n">map_parse_options</span><span class="p">(</span><span class="o">|</span><span class="n">parse_options</span><span class="o">|</span><span class="w"> </span><span class="n">parse_options</span><span class="p">.</span><span class="n">with_try_parse_dates</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span>
</span><span id="__span-45-39"><a id="__codelineno-45-39" name="__codelineno-45-39" href="#__codelineno-45-39"></a><span class="w">    </span><span class="p">.</span><span class="n">into_reader_with_file_handle</span><span class="p">(</span><span class="n">Cursor</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="__span-45-40"><a id="__codelineno-45-40" name="__codelineno-45-40" href="#__codelineno-45-40"></a><span class="w">    </span><span class="p">.</span><span class="n">finish</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-45-41"><a id="__codelineno-45-41" name="__codelineno-45-41" href="#__codelineno-45-41"></a>
</span><span id="__span-45-42"><a id="__codelineno-45-42" name="__codelineno-45-42" href="#__codelineno-45-42"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dataset</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="_18">基本聚合<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h4>
<p>我们可以按 <code>symbol</code> 和 <code>type</code> 分组，并计算每组的成交量总和、开盘价和收盘价的平均值。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataset</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="w">    </span><span class="p">.</span><span class="n">group_by</span><span class="p">([</span><span class="s">&quot;symbol&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;type&quot;</span><span class="p">])</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="w">    </span><span class="p">.</span><span class="n">agg</span><span class="p">([</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="w">        </span><span class="n">sum</span><span class="p">(</span><span class="s">&quot;volume&quot;</span><span class="p">).</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;total_volume&quot;</span><span class="p">),</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="w">        </span><span class="n">mean</span><span class="p">(</span><span class="s">&quot;open&quot;</span><span class="p">).</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;avg_open&quot;</span><span class="p">),</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="w">        </span><span class="n">mean</span><span class="p">(</span><span class="s">&quot;close&quot;</span><span class="p">).</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;avg_close&quot;</span><span class="p">),</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="w">    </span><span class="p">])</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="w">    </span><span class="p">.</span><span class="n">sort</span><span class="p">(</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="w">        </span><span class="p">[</span><span class="s">&quot;total_volume&quot;</span><span class="p">],</span>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="w">        </span><span class="n">SortMultipleOptions</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="w">            </span><span class="p">.</span><span class="n">with_order_descending</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="w">            </span><span class="p">.</span><span class="n">with_nulls_last</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a><span class="w">    </span><span class="p">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a>
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="_19">条件聚合<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h4>
<p>我们想知道每个交易日中涨幅超过5%的交易记录数。可以直接在聚合中查询：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataset</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">    </span><span class="p">.</span><span class="n">group_by</span><span class="p">([</span><span class="s">&quot;trade_date&quot;</span><span class="p">])</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">    </span><span class="p">.</span><span class="n">agg</span><span class="p">([</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">        </span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;close&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;open&quot;</span><span class="p">)).</span><span class="n">gt</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)).</span><span class="n">sum</span><span class="p">().</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;gains_over_5pct&quot;</span><span class="p">),</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w">    </span><span class="p">])</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="w">    </span><span class="p">.</span><span class="n">sort</span><span class="p">(</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="w">        </span><span class="p">[</span><span class="s">&quot;gains_over_5pct&quot;</span><span class="p">],</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="w">        </span><span class="n">SortMultipleOptions</span><span class="p">::</span><span class="n">default</span><span class="p">().</span><span class="n">with_order_descending</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="w">    </span><span class="p">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="_20">嵌套分组<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h4>
<p>在嵌套分组中，表达式在组内工作，因此可以生成任意长度的结果。例如，我们想按 <code>symbol</code> 和 <code>type</code> 分组，并计算每组的交易量总和和记录数：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataset</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">    </span><span class="p">.</span><span class="n">group_by</span><span class="p">([</span><span class="s">&quot;symbol&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;type&quot;</span><span class="p">])</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">    </span><span class="p">.</span><span class="n">agg</span><span class="p">([</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">        </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;volume&quot;</span><span class="p">).</span><span class="n">sum</span><span class="p">().</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;total_volume&quot;</span><span class="p">),</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="w">        </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;symbol&quot;</span><span class="p">).</span><span class="n">count</span><span class="p">().</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;record_count&quot;</span><span class="p">),</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="w">    </span><span class="p">])</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="w">    </span><span class="p">.</span><span class="n">sort</span><span class="p">(</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="w">        </span><span class="p">[</span><span class="s">&quot;total_volume&quot;</span><span class="p">],</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="w">        </span><span class="n">SortMultipleOptions</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="w">            </span><span class="p">.</span><span class="n">with_order_descending</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="w">            </span><span class="p">.</span><span class="n">with_nulls_last</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="w">    </span><span class="p">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a>
</span><span id="__span-48-18"><a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="_21">过滤组内数据<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h4>
<p>我们可以计算每个交易日的平均涨幅，但不包含成交量低于 1000 的交易记录：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">compute_change</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Expr</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="w">    </span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;close&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;open&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;open&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lit</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="p">}</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="k">fn</span><span class="w"> </span><span class="nf">avg_change_with_volume_filter</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Expr</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="w">    </span><span class="n">compute_change</span><span class="p">()</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="w">        </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;volume&quot;</span><span class="p">).</span><span class="n">gt</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">1000</span><span class="p">)))</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w">        </span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="w">        </span><span class="p">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;avg_change_filtered&quot;</span><span class="p">)</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="p">}</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataset</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a><span class="w">    </span><span class="p">.</span><span class="n">group_by</span><span class="p">([</span><span class="s">&quot;trade_date&quot;</span><span class="p">])</span>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a><span class="w">    </span><span class="p">.</span><span class="n">agg</span><span class="p">([</span>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a><span class="w">        </span><span class="n">avg_change_with_volume_filter</span><span class="p">(),</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a><span class="w">        </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;volume&quot;</span><span class="p">).</span><span class="n">sum</span><span class="p">().</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;total_volume&quot;</span><span class="p">),</span>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a><span class="w">    </span><span class="p">])</span>
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a><span class="w">    </span><span class="p">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a>
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23" href="#__codelineno-49-23"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="_22">排序<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h4>
<p>我们可以按交易日期排序，并按 <code>symbol</code> 分组以获得每个 <code>symbol</code> 的最高和最低收盘价：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">get_price_range</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Expr</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">    </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;close&quot;</span><span class="p">)</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="p">}</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataset</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="w">    </span><span class="p">.</span><span class="n">sort</span><span class="p">(</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="w">        </span><span class="p">[</span><span class="s">&quot;trade_date&quot;</span><span class="p">],</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="w">        </span><span class="n">SortMultipleOptions</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="w">            </span><span class="p">.</span><span class="n">with_order_descending</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="w">            </span><span class="p">.</span><span class="n">with_nulls_last</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="w">    </span><span class="p">.</span><span class="n">group_by</span><span class="p">([</span><span class="s">&quot;symbol&quot;</span><span class="p">])</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="w">    </span><span class="p">.</span><span class="n">agg</span><span class="p">([</span>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="w">        </span><span class="n">get_price_range</span><span class="p">().</span><span class="n">max</span><span class="p">().</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;max_close&quot;</span><span class="p">),</span>
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="w">        </span><span class="n">get_price_range</span><span class="p">().</span><span class="n">min</span><span class="p">().</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;min_close&quot;</span><span class="p">),</span>
</span><span id="__span-50-18"><a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a><span class="w">    </span><span class="p">])</span>
</span><span id="__span-50-19"><a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a><span class="w">    </span><span class="p">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-50-20"><a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-50-21"><a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a>
</span><span id="__span-50-22"><a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<p>我们还可以在 <code>group_by</code> 上下文中按另一列排序：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataset</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">    </span><span class="p">.</span><span class="n">sort</span><span class="p">(</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="w">        </span><span class="p">[</span><span class="s">&quot;trade_date&quot;</span><span class="p">],</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">        </span><span class="n">SortMultipleOptions</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">            </span><span class="p">.</span><span class="n">with_order_descending</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="w">            </span><span class="p">.</span><span class="n">with_nulls_last</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">    </span><span class="p">.</span><span class="n">group_by</span><span class="p">([</span><span class="s">&quot;symbol&quot;</span><span class="p">])</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="w">    </span><span class="p">.</span><span class="n">agg</span><span class="p">([</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="w">        </span><span class="n">get_price_range</span><span class="p">().</span><span class="n">max</span><span class="p">().</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;max_close&quot;</span><span class="p">),</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="w">        </span><span class="n">get_price_range</span><span class="p">().</span><span class="n">min</span><span class="p">().</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;min_close&quot;</span><span class="p">),</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="w">        </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="w">            </span><span class="p">.</span><span class="n">sort_by</span><span class="p">([</span><span class="s">&quot;symbol&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">SortMultipleOptions</span><span class="p">::</span><span class="n">default</span><span class="p">())</span>
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="w">            </span><span class="p">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a><span class="w">            </span><span class="p">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;first_type&quot;</span><span class="p">),</span>
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a><span class="w">    </span><span class="p">])</span>
</span><span id="__span-51-19"><a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a><span class="w">    </span><span class="p">.</span><span class="n">sort</span><span class="p">([</span><span class="s">&quot;symbol&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">SortMultipleOptions</span><span class="p">::</span><span class="n">default</span><span class="p">())</span>
</span><span id="__span-51-20"><a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a><span class="w">    </span><span class="p">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-51-21"><a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-51-22"><a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a>
</span><span id="__span-51-23"><a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="2332-folds">23.3.2 Folds<a class="headerlink" href="#2332-folds" title="Permanent link">&para;</a></h3>
<h3 id="folds">Folds<a class="headerlink" href="#folds" title="Permanent link">&para;</a></h3>
<p>Polars 提供了一些用于横向聚合的表达式和方法，如 sum、min、mean 等。然而，当你需要更复杂的聚合时，Polars 默认的方法可能不够用。这时，折叠（fold）操作就派上用场了。</p>
<p>折叠表达式在列上操作，最大限度地提高了速度。它非常高效地利用数据布局，并且通常具有向量化执行的特点。</p>
<h4 id="_23">手动求和<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h4>
<p>我们从一个示例开始，通过折叠实现求和操作。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="w">    </span><span class="s">&quot;price&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">],</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="w">    </span><span class="s">&quot;quantity&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">],</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="w">    </span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">fold_exprs</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="o">|</span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="nb">Some</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">)]).</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;sum&quot;</span><span class="p">)])</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="err">┌─────┐</span>
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="err">│</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-52-17"><a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a><span class="err">│</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-52-18"><a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a><span class="err">│</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-52-19"><a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a><span class="err">╞═════╡</span>
</span><span id="__span-52-20"><a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a><span class="err">│</span><span class="w"> </span><span class="mi">102</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-52-21"><a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a><span class="err">│</span><span class="w"> </span><span class="mi">203</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-52-22"><a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a><span class="err">│</span><span class="w"> </span><span class="mi">304</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-52-23"><a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a><span class="err">└─────┘</span>
</span></code></pre></div>
<p>上述代码递归地将函数 <code>f(acc, x) -&gt; acc</code> 应用到累加器 <code>acc</code> 和新列 <code>x</code> 上。这个函数单独在列上操作，可以利用缓存效率和向量化执行。</p>
<h4 id="_24">条件聚合<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h4>
<p>如果你想对 DataFrame 中的所有列应用条件或谓词，折叠操作可以非常简洁地表达这种需求。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="w">    </span><span class="s">&quot;price&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">],</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="w">    </span><span class="s">&quot;quantity&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">],</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="w">    </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">fold_exprs</span><span class="p">(</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="w">        </span><span class="n">lit</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="w">        </span><span class="o">|</span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">acc</span><span class="p">.</span><span class="n">bitand</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="nb">Some</span><span class="p">),</span>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="w">        </span><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">).</span><span class="n">gt</span><span class="p">(</span><span class="mi">150</span><span class="p">)],</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a><span class="w">    </span><span class="p">))</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="err">┌───────┬─────────┐</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a><span class="err">│</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="err">┆</span><span class="w"> </span><span class="n">quantity</span><span class="err">│</span>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a><span class="err">│</span><span class="w"> </span><span class="o">-----</span><span class="w"> </span><span class="err">┆</span><span class="w"> </span><span class="o">-------</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a><span class="err">│</span><span class="w"> </span><span class="kt">i64</span><span class="w">   </span><span class="err">┆</span><span class="w"> </span><span class="kt">i64</span><span class="w">     </span><span class="err">│</span>
</span><span id="__span-53-21"><a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a><span class="err">╞═══════╪═════════╡</span>
</span><span id="__span-53-22"><a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a><span class="err">│</span><span class="w"> </span><span class="mi">300</span><span class="w">   </span><span class="err">┆</span><span class="w"> </span><span class="mi">4</span><span class="w">       </span><span class="err">│</span>
</span><span id="__span-53-23"><a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a><span class="err">└───────┴─────────┘</span>
</span></code></pre></div>
<p>在上述代码片段中，我们过滤出所有列值大于 150 的行。</p>
<h4 id="_25">折叠和字符串数据<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h4>
<p>折叠可以用来连接字符串数据。然而，由于中间列的物化，这种操作的复杂度会呈平方级增长。因此，我们推荐使用 <code>concat_str</code> 表达式来完成这类操作。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="w">    </span><span class="s">&quot;symbol&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="s">&quot;AAPL&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;GOOGL&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AMZN&quot;</span><span class="p">],</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="w">    </span><span class="s">&quot;price&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">150</span><span class="p">,</span><span class="w"> </span><span class="mi">2800</span><span class="p">,</span><span class="w"> </span><span class="mi">3400</span><span class="p">],</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="w">    </span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">concat_str</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;symbol&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">)],</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">).</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;combined&quot;</span><span class="p">)])</span>
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a>
</span><span id="__span-54-14"><a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-54-15"><a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a><span class="err">┌───────────┐</span>
</span><span id="__span-54-16"><a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a><span class="err">│</span><span class="w"> </span><span class="n">combined</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-54-17"><a id="__codelineno-54-17" name="__codelineno-54-17" href="#__codelineno-54-17"></a><span class="err">│</span><span class="w"> </span><span class="o">---</span><span class="w">       </span><span class="err">│</span>
</span><span id="__span-54-18"><a id="__codelineno-54-18" name="__codelineno-54-18" href="#__codelineno-54-18"></a><span class="err">│</span><span class="w"> </span><span class="kt">str</span><span class="w">       </span><span class="err">│</span>
</span><span id="__span-54-19"><a id="__codelineno-54-19" name="__codelineno-54-19" href="#__codelineno-54-19"></a><span class="err">╞═══════════╡</span>
</span><span id="__span-54-20"><a id="__codelineno-54-20" name="__codelineno-54-20" href="#__codelineno-54-20"></a><span class="err">│</span><span class="w"> </span><span class="n">AAPL150</span><span class="w">   </span><span class="err">│</span>
</span><span id="__span-54-21"><a id="__codelineno-54-21" name="__codelineno-54-21" href="#__codelineno-54-21"></a><span class="err">│</span><span class="w"> </span><span class="n">GOOGL2800</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-54-22"><a id="__codelineno-54-22" name="__codelineno-54-22" href="#__codelineno-54-22"></a><span class="err">│</span><span class="w"> </span><span class="n">AMZN3400</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-54-23"><a id="__codelineno-54-23" name="__codelineno-54-23" href="#__codelineno-54-23"></a><span class="err">└───────────┘</span>
</span></code></pre></div>
<p>通过使用 <code>concat_str</code> 表达式，我们可以高效地连接字符串数据，避免了复杂的操作。</p>
<h3 id="2333-csv-input">23.3.3 CSV input<a class="headerlink" href="#2333-csv-input" title="Permanent link">&para;</a></h3>
<h3 id="csv">CSV<a class="headerlink" href="#csv" title="Permanent link">&para;</a></h3>
<h4 id="_26">读取与写入<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h4>
<p>读取CSV文件的方式很常见：
<div class="language-rust highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CsvReadOptions</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="w">    </span><span class="p">.</span><span class="n">try_into_reader_with_file_path</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="s">&quot;docs/data/path.csv&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">()))</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">    </span><span class="p">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
</span></code></pre></div>
在这个示例中，我们使用<code>CsvReadOptions</code>来设置CSV读取选项，然后将文件路径传递给<code>try_into_reader_with_file_path</code>方法，最终通过<code>finish</code>方法完成读取并获取DataFrame。</p>
<p>写入CSV文件使用<code>write_csv</code>函数：
<div class="language-rust highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="w">    </span><span class="s">&quot;foo&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="w">    </span><span class="s">&quot;bar&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="s">&quot;bak&quot;</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="s">&quot;baz&quot;</span><span class="p">)],</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">File</span><span class="p">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;docs/data/path.csv&quot;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="n">CsvWriter</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="p">).</span><span class="n">finish</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">df</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span></code></pre></div>
在这个示例中，我们创建一个DataFrame并将其写入指定路径的CSV文件中。</p>
<h4 id="csv_1">扫描CSV<a class="headerlink" href="#csv_1" title="Permanent link">&para;</a></h4>
<p>Polars允许你扫描CSV输入。扫描延迟了文件的实际解析，返回一个名为LazyFrame的惰性计算持有者。
<div class="language-rust highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">lf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LazyCsvReader</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;./test.csv&quot;</span><span class="p">).</span><span class="n">finish</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
</span></code></pre></div>
使用<code>LazyCsvReader</code>，可以在不立即解析文件的情况下处理CSV输入，这对优化性能有很大帮助。</p>
<h3 id="_27">教程总结<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h3>
<h4 id="csv_2">读取CSV文件<a class="headerlink" href="#csv_2" title="Permanent link">&para;</a></h4>
<ol>
<li>导入Polars库。</li>
<li>使用<code>CsvReadOptions</code>配置CSV读取选项。</li>
<li>调用<code>try_into_reader_with_file_path</code>方法传入文件路径。</li>
<li>使用<code>finish</code>方法完成读取并获取DataFrame。</li>
</ol>
<h4 id="csv_3">写入CSV文件<a class="headerlink" href="#csv_3" title="Permanent link">&para;</a></h4>
<ol>
<li>创建一个DataFrame对象。</li>
<li>使用<code>std::fs::File::create</code>创建文件。</li>
<li>使用<code>CsvWriter</code>将DataFrame写入CSV文件。</li>
</ol>
<h4 id="csv_4">扫描CSV文件<a class="headerlink" href="#csv_4" title="Permanent link">&para;</a></h4>
<ol>
<li>使用<code>LazyCsvReader</code>延迟解析CSV文件。</li>
<li>使用<code>finish</code>方法获取LazyFrame。</li>
</ol>
<p>通过以上方法，可以高效地读取、写入和扫描CSV文件，极大地提升数据处理的性能和灵活性。</p>
<h3 id="_28">参考代码示例<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<h4 id="csv_5">读取CSV文件<a class="headerlink" href="#csv_5" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CsvReadOptions</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="w">    </span><span class="p">.</span><span class="n">try_into_reader_with_file_path</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="s">&quot;docs/data/path.csv&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">()))</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="w">    </span><span class="p">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="csv_6">写入CSV文件<a class="headerlink" href="#csv_6" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="w">    </span><span class="s">&quot;foo&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="w">    </span><span class="s">&quot;bar&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="s">&quot;bak&quot;</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="s">&quot;baz&quot;</span><span class="p">)],</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">File</span><span class="p">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;docs/data/path.csv&quot;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="n">CsvWriter</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="p">).</span><span class="n">finish</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">df</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span></code></pre></div>
<h4 id="csv_7">扫描CSV文件<a class="headerlink" href="#csv_7" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">lf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LazyCsvReader</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;./test.csv&quot;</span><span class="p">).</span><span class="n">finish</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lf</span><span class="p">);</span>
</span></code></pre></div>
<p>通过上述步骤，用户可以轻松掌握在Rust中使用Polars处理CSV文件的基本方法。</p>
<h3 id="2334-json-input">23.3.4 JSON input<a class="headerlink" href="#2334-json-input" title="Permanent link">&para;</a></h3>
<h3 id="json">JSON 文件<a class="headerlink" href="#json" title="Permanent link">&para;</a></h3>
<p>Polars 可以读取和写入标准 JSON 和换行分隔的 JSON (NDJSON)。</p>
<h4 id="_29">读取<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h4>
<h5 id="json_1">标准 JSON<a class="headerlink" href="#json_1" title="Permanent link">&para;</a></h5>
<p>读取 JSON 文件的方式如下：
<div class="language-rust highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">File</span><span class="p">::</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;docs/data/path.json&quot;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonReader</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="p">).</span><span class="n">finish</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
</span></code></pre></div></p>
<h5 id="json_2">换行分隔的 JSON<a class="headerlink" href="#json_2" title="Permanent link">&para;</a></h5>
<p>Polars 可以更高效地读取 NDJSON 文件：
<div class="language-rust highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">File</span><span class="p">::</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;docs/data/path.json&quot;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonLineReader</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="p">).</span><span class="n">finish</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
</span></code></pre></div></p>
<h4 id="_30">写入<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h4>
<p>将 DataFrame 写入 JSON 文件：
<div class="language-rust highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="w">    </span><span class="s">&quot;foo&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w">    </span><span class="s">&quot;bar&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="s">&quot;bak&quot;</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="s">&quot;baz&quot;</span><span class="p">)],</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">File</span><span class="p">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;docs/data/path.json&quot;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="c1">// 写入标准 JSON</span>
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="n">JsonWriter</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="p">)</span>
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="w">    </span><span class="p">.</span><span class="n">with_json_format</span><span class="p">(</span><span class="n">JsonFormat</span><span class="p">::</span><span class="n">Json</span><span class="p">)</span>
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a><span class="w">    </span><span class="p">.</span><span class="n">finish</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">df</span><span class="p">)</span>
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a><span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-63-13"><a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a>
</span><span id="__span-63-14"><a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a><span class="c1">// 写入 NDJSON</span>
</span><span id="__span-63-15"><a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a><span class="n">JsonWriter</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="p">)</span>
</span><span id="__span-63-16"><a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a><span class="w">    </span><span class="p">.</span><span class="n">with_json_format</span><span class="p">(</span><span class="n">JsonFormat</span><span class="p">::</span><span class="n">JsonLines</span><span class="p">)</span>
</span><span id="__span-63-17"><a id="__codelineno-63-17" name="__codelineno-63-17" href="#__codelineno-63-17"></a><span class="w">    </span><span class="p">.</span><span class="n">finish</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">df</span><span class="p">)</span>
</span><span id="__span-63-18"><a id="__codelineno-63-18" name="__codelineno-63-18" href="#__codelineno-63-18"></a><span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
</span></code></pre></div></p>
<h4 id="_31">扫描<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h4>
<p>Polars 允许仅扫描换行分隔的 JSON 输入。扫描延迟了文件的实际解析，返回一个名为 LazyFrame 的惰性计算持有者。
<div class="language-rust highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">lf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LazyJsonLineReader</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;docs/data/path.json&quot;</span><span class="p">)</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="w">    </span><span class="p">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
</span></code></pre></div></p>
<h3 id="2335-polars-lazy-eager-api">23.3.5 Polars的急性和惰性模式 (Lazy / Eager API)<a class="headerlink" href="#2335-polars-lazy-eager-api" title="Permanent link">&para;</a></h3>
<p>Polars 提供了两种操作模式：急性（Eager）和惰性（Lazy）。急性模式下，查询会立即执行，而惰性模式下，查询会在“需要”时才评估。推迟执行可以显著提升性能，因此在大多数情况下优先使用惰性 API。下面通过一个例子进行说明：</p>
<h4 id="_32">急性模式示例<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h4>
<p><div class="language-rust highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CsvReadOptions</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="w">    </span><span class="p">.</span><span class="n">try_into_reader_with_file_path</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="s">&quot;docs/data/iris.csv&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">()))</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="w">    </span><span class="p">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="kd">let</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">column</span><span class="p">(</span><span class="s">&quot;sepal_length&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="kt">f64</span><span class="p">()</span><span class="o">?</span><span class="p">.</span><span class="n">gt</span><span class="p">(</span><span class="mf">5.0</span><span class="p">);</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="kd">let</span><span class="w"> </span><span class="n">df_small</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mask</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="cp">#[allow(deprecated)]</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="kd">let</span><span class="w"> </span><span class="n">df_agg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_small</span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="w">    </span><span class="p">.</span><span class="n">group_by</span><span class="p">([</span><span class="s">&quot;species&quot;</span><span class="p">])</span><span class="o">?</span>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a><span class="w">    </span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="s">&quot;sepal_width&quot;</span><span class="p">])</span>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a><span class="w">    </span><span class="p">.</span><span class="n">mean</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df_agg</span><span class="p">);</span>
</span></code></pre></div>
在这个例子中，我们使用急性 API：
1. 读取鸢尾花数据集。
2. 根据萼片长度过滤数据集。
3. 计算每个物种的萼片宽度平均值。</p>
<p>每一步都立即执行并返回中间结果。这可能会浪费资源，因为我们可能会执行不必要的工作或加载未使用的数据。</p>
<h4 id="_33">惰性模式示例<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h4>
<p><div class="language-rust highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LazyCsvReader</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;docs/data/iris.csv&quot;</span><span class="p">)</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="w">    </span><span class="p">.</span><span class="n">with_has_header</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="w">    </span><span class="p">.</span><span class="n">finish</span><span class="p">()</span><span class="o">?</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="w">    </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;sepal_length&quot;</span><span class="p">).</span><span class="n">gt</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="w">    </span><span class="p">.</span><span class="n">group_by</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;species&quot;</span><span class="p">)])</span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="w">    </span><span class="p">.</span><span class="n">agg</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;sepal_width&quot;</span><span class="p">).</span><span class="n">mean</span><span class="p">()]);</span>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
在这个例子中，使用惰性 API 可以进行以下优化：
1. 谓词下推（Predicate pushdown）：在读取数据集时尽早应用过滤器，仅读取萼片长度大于 5 的行。
2. 投影下推（Projection pushdown）：在读取数据集时只选择所需的列，从而不需要加载额外的列（如花瓣长度和花瓣宽度）。</p>
<p>这些优化显著降低了内存和 CPU 的负载，从而允许在内存中处理更大的数据集并加快处理速度。一旦定义了查询，通过调用 <code>collect</code> 来执行它。在 Lazy API 章节中，我们将详细讨论其实现。</p>
<h3 id="api">急性 API<a class="headerlink" href="#api" title="Permanent link">&para;</a></h3>
<p>在很多情况下，急性 API 实际上是在底层调用惰性 API，并立即收集结果。这具有在查询内部仍然可以进行查询计划优化的好处。</p>
<h3 id="_34">何时使用哪种模式<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h3>
<p>通常应优先使用惰性 API，除非您对中间结果感兴趣或正在进行探索性工作，并且尚不确定查询的最终形态。</p>
<h3 id="_35">量化金融案例<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h3>
<h4 id="sma">急性模式示例：计算股票的简单移动平均线（SMA）<a class="headerlink" href="#sma" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="k">use</span><span class="w"> </span><span class="n">chrono</span><span class="p">::</span><span class="n">NaiveDate</span><span class="p">;</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="w">    </span><span class="s">&quot;date&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span>
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span>
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-67-12"><a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a><span class="w">    </span><span class="s">&quot;price&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span><span class="w"> </span><span class="mf">101.0</span><span class="p">,</span><span class="w"> </span><span class="mf">102.0</span><span class="p">,</span><span class="w"> </span><span class="mf">103.0</span><span class="p">,</span><span class="w"> </span><span class="mf">104.0</span><span class="p">],</span>
</span><span id="__span-67-13"><a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-67-14"><a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a>
</span><span id="__span-67-15"><a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a><span class="kd">let</span><span class="w"> </span><span class="n">sma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-67-16"><a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-67-17"><a id="__codelineno-67-17" name="__codelineno-67-17" href="#__codelineno-67-17"></a><span class="w">    </span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">).</span><span class="n">rolling_mean</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">).</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;SMA&quot;</span><span class="p">)])</span>
</span><span id="__span-67-18"><a id="__codelineno-67-18" name="__codelineno-67-18" href="#__codelineno-67-18"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-67-19"><a id="__codelineno-67-19" name="__codelineno-67-19" href="#__codelineno-67-19"></a>
</span><span id="__span-67-20"><a id="__codelineno-67-20" name="__codelineno-67-20" href="#__codelineno-67-20"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sma</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="wma">惰性模式示例：计算股票的加权移动平均线（WMA）<a class="headerlink" href="#wma" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="w">    </span><span class="s">&quot;date&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span>
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="w">        </span><span class="n">NaiveDate</span><span class="p">::</span><span class="n">from_ymd</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span>
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a><span class="w">    </span><span class="s">&quot;price&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span><span class="w"> </span><span class="mf">101.0</span><span class="p">,</span><span class="w"> </span><span class="mf">102.0</span><span class="p">,</span><span class="w"> </span><span class="mf">103.0</span><span class="p">,</span><span class="w"> </span><span class="mf">104.0</span><span class="p">],</span>
</span><span id="__span-68-10"><a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-68-11"><a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a>
</span><span id="__span-68-12"><a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a><span class="kd">let</span><span class="w"> </span><span class="n">weights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">];</span>
</span><span id="__span-68-13"><a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a>
</span><span id="__span-68-14"><a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a><span class="kd">let</span><span class="w"> </span><span class="n">wma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-68-15"><a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-68-16"><a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a><span class="w">    </span><span class="p">.</span><span class="n">with_column</span><span class="p">(</span>
</span><span id="__span-68-17"><a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a><span class="w">        </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">)</span>
</span><span id="__span-68-18"><a id="__codelineno-68-18" name="__codelineno-68-18" href="#__codelineno-68-18"></a><span class="w">            </span><span class="p">.</span><span class="n">rolling_apply</span><span class="p">(</span>
</span><span id="__span-68-19"><a id="__codelineno-68-19" name="__codelineno-68-19" href="#__codelineno-68-19"></a><span class="w">                </span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-20"><a id="__codelineno-68-20" name="__codelineno-68-20" href="#__codelineno-68-20"></a><span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">weighted_sum</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span>
</span><span id="__span-68-21"><a id="__codelineno-68-21" name="__codelineno-68-21" href="#__codelineno-68-21"></a><span class="w">                        </span><span class="p">.</span><span class="kt">f64</span><span class="p">()</span>
</span><span id="__span-68-22"><a id="__codelineno-68-22" name="__codelineno-68-22" href="#__codelineno-68-22"></a><span class="w">                        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
</span><span id="__span-68-23"><a id="__codelineno-68-23" name="__codelineno-68-23" href="#__codelineno-68-23"></a><span class="w">                        </span><span class="p">.</span><span class="n">into_iter</span><span class="p">()</span>
</span><span id="__span-68-24"><a id="__codelineno-68-24" name="__codelineno-68-24" href="#__codelineno-68-24"></a><span class="w">                        </span><span class="p">.</span><span class="n">zip</span><span class="p">(</span><span class="o">&amp;</span><span class="n">weights</span><span class="p">)</span>
</span><span id="__span-68-25"><a id="__codelineno-68-25" name="__codelineno-68-25" href="#__codelineno-68-25"></a><span class="w">                        </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">w</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="p">)</span>
</span><span id="__span-68-26"><a id="__codelineno-68-26" name="__codelineno-68-26" href="#__codelineno-68-26"></a><span class="w">                        </span><span class="p">.</span><span class="n">sum</span><span class="p">();</span>
</span><span id="__span-68-27"><a id="__codelineno-68-27" name="__codelineno-68-27" href="#__codelineno-68-27"></a><span class="w">                    </span><span class="nb">Some</span><span class="p">(</span><span class="n">weighted_sum</span><span class="p">)</span>
</span><span id="__span-68-28"><a id="__codelineno-68-28" name="__codelineno-68-28" href="#__codelineno-68-28"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-68-29"><a id="__codelineno-68-29" name="__codelineno-68-29" href="#__codelineno-68-29"></a><span class="w">                </span><span class="mi">3</span><span class="p">,</span>
</span><span id="__span-68-30"><a id="__codelineno-68-30" name="__codelineno-68-30" href="#__codelineno-68-30"></a><span class="w">                </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="n">RollingOptions</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
</span><span id="__span-68-31"><a id="__codelineno-68-31" name="__codelineno-68-31" href="#__codelineno-68-31"></a><span class="w">                    </span><span class="p">.</span><span class="n">min_periods</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-68-32"><a id="__codelineno-68-32" name="__codelineno-68-32" href="#__codelineno-68-32"></a><span class="w">                    </span><span class="p">.</span><span class="n">center</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-68-33"><a id="__codelineno-68-33" name="__codelineno-68-33" href="#__codelineno-68-33"></a><span class="w">                    </span><span class="p">.</span><span class="n">window_size</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-68-34"><a id="__codelineno-68-34" name="__codelineno-68-34" href="#__codelineno-68-34"></a><span class="w">            </span><span class="p">)</span>
</span><span id="__span-68-35"><a id="__codelineno-68-35" name="__codelineno-68-35" href="#__codelineno-68-35"></a><span class="w">            </span><span class="p">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;WMA&quot;</span><span class="p">)</span>
</span><span id="__span-68-36"><a id="__codelineno-68-36" name="__codelineno-68-36" href="#__codelineno-68-36"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-68-37"><a id="__codelineno-68-37" name="__codelineno-68-37" href="#__codelineno-68-37"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-68-38"><a id="__codelineno-68-38" name="__codelineno-68-38" href="#__codelineno-68-38"></a>
</span><span id="__span-68-39"><a id="__codelineno-68-39" name="__codelineno-68-39" href="#__codelineno-68-39"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">wma</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="2336-streaming-mode">23.3.6 流模式 (Streaming Mode)<a class="headerlink" href="#2336-streaming-mode" title="Permanent link">&para;</a></h3>
<p>Polars 引入了一个强大的功能叫做流模式（Streaming Mode），设计用于通过分块处理数据来高效处理大型数据集。该模式显著提高了数据处理任务的性能，特别是在处理无法全部装入内存的海量数据集时。</p>
<h4 id="_36">流模式的关键特性：<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>基于块的处理</strong>：Polars 以块的形式处理数据，减少内存使用，使其能够高效处理大型数据集。</li>
<li><strong>自动优化</strong>：流模式包含诸如谓词下推（predicate pushdown）和投影下推（projection pushdown）等优化，以最小化处理和读取的数据量。</li>
<li><strong>并行执行</strong>：Polars 利用所有可用的 CPU 核心，通过划分工作负载来加快数据处理速度。</li>
</ol>
<h4 id="_37">量化金融案例<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h4>
<p>考虑一个需要处理大型股票交易数据集的场景。使用 Polars 流模式，我们可以高效地从包含数百万交易记录的 CSV 文件中计算每个股票代码的平均交易价格。</p>
<h5 id="api_1">急性 API 示例<a class="headerlink" href="#api_1" title="Permanent link">&para;</a></h5>
<p>使用急性 API 时，操作会立即执行：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CsvReadOptions</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="w">    </span><span class="p">.</span><span class="n">try_into_reader_with_file_path</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="s">&quot;docs/data/stock_trades.csv&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">()))</span>
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="w">    </span><span class="p">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a>
</span><span id="__span-69-9"><a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a><span class="kd">let</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">column</span><span class="p">(</span><span class="s">&quot;trade_price&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="kt">f64</span><span class="p">()</span><span class="o">?</span><span class="p">.</span><span class="n">gt</span><span class="p">(</span><span class="mf">100.0</span><span class="p">);</span>
</span><span id="__span-69-10"><a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a><span class="kd">let</span><span class="w"> </span><span class="n">df_filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mask</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-69-11"><a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a><span class="cp">#[allow(deprecated)]</span>
</span><span id="__span-69-12"><a id="__codelineno-69-12" name="__codelineno-69-12" href="#__codelineno-69-12"></a><span class="kd">let</span><span class="w"> </span><span class="n">df_agg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_filtered</span>
</span><span id="__span-69-13"><a id="__codelineno-69-13" name="__codelineno-69-13" href="#__codelineno-69-13"></a><span class="w">    </span><span class="p">.</span><span class="n">group_by</span><span class="p">([</span><span class="s">&quot;stock_symbol&quot;</span><span class="p">])</span><span class="o">?</span>
</span><span id="__span-69-14"><a id="__codelineno-69-14" name="__codelineno-69-14" href="#__codelineno-69-14"></a><span class="w">    </span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="s">&quot;trade_price&quot;</span><span class="p">])</span>
</span><span id="__span-69-15"><a id="__codelineno-69-15" name="__codelineno-69-15" href="#__codelineno-69-15"></a><span class="w">    </span><span class="p">.</span><span class="n">mean</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-69-16"><a id="__codelineno-69-16" name="__codelineno-69-16" href="#__codelineno-69-16"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df_agg</span><span class="p">);</span>
</span></code></pre></div>
<p>在这个示例中：
1. 读取数据集。
2. 基于交易价格过滤数据集。
3. 计算每个股票代码的平均交易价格。</p>
<h5 id="api_2">惰性 API 示例（带流模式）<a class="headerlink" href="#api_2" title="Permanent link">&para;</a></h5>
<p>使用惰性 API 并启用流模式可以延迟执行和优化：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LazyCsvReader</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;docs/data/stock_trades.csv&quot;</span><span class="p">)</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="w">    </span><span class="p">.</span><span class="n">with_has_header</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="w">    </span><span class="p">.</span><span class="n">finish</span><span class="p">()</span><span class="o">?</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="w">    </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;trade_price&quot;</span><span class="p">).</span><span class="n">gt</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">100</span><span class="p">)))</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="w">    </span><span class="p">.</span><span class="n">group_by</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;stock_symbol&quot;</span><span class="p">)])</span>
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="w">    </span><span class="p">.</span><span class="n">agg</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;trade_price&quot;</span><span class="p">).</span><span class="n">mean</span><span class="p">()]);</span>
</span><span id="__span-70-9"><a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-70-10"><a id="__codelineno-70-10" name="__codelineno-70-10" href="#__codelineno-70-10"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<p>在这个示例中：
1. 定义查询但不立即执行。
2. 查询计划器在数据扫描期间应用优化，如过滤和选择列。
3. 查询以块的形式执行，减少内存使用并提高性能。</p>
<h4 id="_38">配置块大小<a class="headerlink" href="#_38" title="Permanent link">&para;</a></h4>
<p>默认块大小由列数和可用线程数决定，但可以手动设置以进一步优化性能：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="n">pl</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">set_streaming_chunk_size</span><span class="p">(</span><span class="mi">50000</span><span class="p">);</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="kd">let</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LazyCsvReader</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;docs/data/stock_trades.csv&quot;</span><span class="p">)</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="w">    </span><span class="p">.</span><span class="n">with_has_header</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="w">    </span><span class="p">.</span><span class="n">finish</span><span class="p">()</span><span class="o">?</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="w">    </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;trade_price&quot;</span><span class="p">).</span><span class="n">gt</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">100</span><span class="p">)))</span>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="w">    </span><span class="p">.</span><span class="n">group_by</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;stock_symbol&quot;</span><span class="p">)])</span>
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="w">    </span><span class="p">.</span><span class="n">agg</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;trade_price&quot;</span><span class="p">).</span><span class="n">mean</span><span class="p">()]);</span>
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<p>设置块大小有助于根据具体需求和硬件能力平衡内存使用和处理速度。</p>
<h3 id="_39">流模式的优势<a class="headerlink" href="#_39" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>内存效率</strong>：通过分块处理数据，显著减少内存使用。</li>
<li><strong>速度</strong>：并行执行和查询优化加快了数据处理速度。</li>
<li><strong>可扩展性</strong>：通过从磁盘中分块流式传输数据，处理超过内存限制的大型数据集。</li>
</ol>
<p>Polars 流模式在量化金融中尤其有用，因为大量数据集很常见，高效的数据处理对于及时分析和决策至关重要。</p>
<h3 id="_40">使用流模式执行查询<a class="headerlink" href="#_40" title="Permanent link">&para;</a></h3>
<p>Polars 支持通过传递 <code>streaming=True</code> 参数到 <code>collect</code> 方法，以流方式执行查询。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">q1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LazyCsvReader</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;docs/data/iris.csv&quot;</span><span class="p">)</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="w">    </span><span class="p">.</span><span class="n">with_has_header</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="w">    </span><span class="p">.</span><span class="n">finish</span><span class="p">()</span><span class="o">?</span>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="w">    </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;sepal_length&quot;</span><span class="p">).</span><span class="n">gt</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a><span class="w">    </span><span class="p">.</span><span class="n">group_by</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;species&quot;</span><span class="p">)])</span>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a><span class="w">    </span><span class="p">.</span><span class="n">agg</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;sepal_width&quot;</span><span class="p">).</span><span class="n">mean</span><span class="p">()]);</span>
</span><span id="__span-72-9"><a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a>
</span><span id="__span-72-10"><a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q1</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">with_streaming</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-72-11"><a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="_41">何时可用流模式？<a class="headerlink" href="#_41" title="Permanent link">&para;</a></h4>
<p>流模式仍在开发中。我们可以请求 Polars 以流模式执行任何惰性查询，但并非所有惰性操作都支持流模式。如果某个操作不支持流模式，Polars 将在非流模式下运行查询。</p>
<p>流模式支持许多操作，包括：
- 过滤、切片、头、尾
- with_columns、select
- group_by
- 连接
- 唯一
- 排序
- 爆炸、反透视
- scan_csv、scan_parquet、scan_ipc</p>
<p>这个列表并不详尽。Polars 正在积极开发中，更多操作可能会在没有明确通知的情况下添加。</p>
<h4 id="_42">示例（带支持操作）<a class="headerlink" href="#_42" title="Permanent link">&para;</a></h4>
<p>要确定查询的哪些部分是流式的，可以使用 <code>explain</code> 方法。以下是一个演示如何检查查询计划的示例：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">query_plan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q1</span><span class="p">.</span><span class="n">with_streaming</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="n">explain</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">query_plan</span><span class="p">);</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="n">STREAMING</span><span class="p">:</span>
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="w">  </span><span class="nc">AGGREGATE</span>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="w">    </span><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;sepal_width&quot;</span><span class="p">).</span><span class="n">mean</span><span class="p">()]</span><span class="w"> </span><span class="n">BY</span><span class="w"> </span><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;species&quot;</span><span class="p">)]</span><span class="w"> </span><span class="n">FROM</span>
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="w">    </span><span class="n">Csv</span><span class="w"> </span><span class="n">SCAN</span><span class="w"> </span><span class="p">[</span><span class="n">docs</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">iris</span><span class="p">.</span><span class="n">csv</span><span class="p">]</span>
</span><span id="__span-73-10"><a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a><span class="w">    </span><span class="n">PROJECT</span><span class="w"> </span><span class="mi">3</span><span class="o">/</span><span class="mi">5</span><span class="w"> </span><span class="n">COLUMNS</span>
</span><span id="__span-73-11"><a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a><span class="w">    </span><span class="n">SELECTION</span><span class="p">:</span><span class="w"> </span><span class="p">[(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;sepal_length&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="mf">5.0</span><span class="p">)]</span>
</span></code></pre></div>
<h4 id="_43">示例（带非流式操作）<a class="headerlink" href="#_43" title="Permanent link">&para;</a></h4>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">q2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LazyCsvReader</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;docs/data/iris.csv&quot;</span><span class="p">)</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="w">    </span><span class="p">.</span><span class="n">finish</span><span class="p">()</span><span class="o">?</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="w">    </span><span class="p">.</span><span class="n">with_columns</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;sepal_length&quot;</span><span class="p">)</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="w">        </span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="w">        </span><span class="p">.</span><span class="n">over</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;species&quot;</span><span class="p">)])</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="w">        </span><span class="p">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;sepal_length_mean&quot;</span><span class="p">)]);</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="kd">let</span><span class="w"> </span><span class="n">query_plan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q2</span><span class="p">.</span><span class="n">with_streaming</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="n">explain</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">query_plan</span><span class="p">);</span>
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a>
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a><span class="n">WITH_COLUMNS</span><span class="p">:</span>
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;sepal_length&quot;</span><span class="p">).</span><span class="n">mean</span><span class="p">().</span><span class="n">over</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;species&quot;</span><span class="p">)])]</span><span class="w"> </span>
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a><span class="n">STREAMING</span><span class="p">:</span>
</span><span id="__span-74-16"><a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a><span class="nc">Csv</span><span class="w"> </span><span class="n">SCAN</span><span class="w"> </span><span class="p">[</span><span class="n">docs</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">iris</span><span class="p">.</span><span class="n">csv</span><span class="p">]</span>
</span><span id="__span-74-17"><a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a><span class="n">PROJECT</span><span class="w"> </span><span class="o">*/</span><span class="mi">5</span><span class="w"> </span><span class="n">COLUMNS</span>
</span></code></pre></div>
<h3 id="2337-missihg-values">23.3.7 缺失值处理 Missihg Values<a class="headerlink" href="#2337-missihg-values" title="Permanent link">&para;</a></h3>
<p>本页面介绍了在 Polars 中如何表示缺失数据以及如何填充缺失数据。</p>
<h3 id="null-nan">null 和 NaN 值<a class="headerlink" href="#null-nan" title="Permanent link">&para;</a></h3>
<p>在 Polars 中，每个 DataFrame（或 Series）中的列都是一个 Arrow 数组或基于 Apache Arrow 规范的 Arrow 数组集合。缺失数据在 Arrow 和 Polars 中用 null 值表示。这种 null 缺失值适用于所有数据类型，包括数值型数据。</p>
<p>此外，Polars 还允许在浮点数列中使用 NaN（非数值）值。NaN 值被视为浮点数据类型的一部分，而不是缺失数据。我们将在下面单独讨论 NaN 值。</p>
<p>可以使用 Rust 中的 <code>None</code> 值手动定义缺失值：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="w">    </span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">],</span>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a>
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">df</span><span class="p">);</span>
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a>
</span><span id="__span-75-9"><a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-75-10"><a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="err">┌───────┐</span>
</span><span id="__span-75-11"><a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="err">│</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-75-12"><a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="err">│</span><span class="w"> </span><span class="o">---</span><span class="w">   </span><span class="err">│</span>
</span><span id="__span-75-13"><a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a><span class="err">│</span><span class="w"> </span><span class="kt">i64</span><span class="w">   </span><span class="err">│</span>
</span><span id="__span-75-14"><a id="__codelineno-75-14" name="__codelineno-75-14" href="#__codelineno-75-14"></a><span class="err">╞═══════╡</span>
</span><span id="__span-75-15"><a id="__codelineno-75-15" name="__codelineno-75-15" href="#__codelineno-75-15"></a><span class="err">│</span><span class="w"> </span><span class="mi">1</span><span class="w">     </span><span class="err">│</span>
</span><span id="__span-75-16"><a id="__codelineno-75-16" name="__codelineno-75-16" href="#__codelineno-75-16"></a><span class="err">│</span><span class="w"> </span><span class="n">null</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-75-17"><a id="__codelineno-75-17" name="__codelineno-75-17" href="#__codelineno-75-17"></a><span class="err">└───────┘</span>
</span></code></pre></div>
<h3 id="_44">缺失数据元数据<a class="headerlink" href="#_44" title="Permanent link">&para;</a></h3>
<p>每个由 Polars 使用的 Arrow 数组都存储了与缺失数据相关的两种元数据。这些元数据允许 Polars 快速显示有多少缺失值以及哪些值是缺失的。</p>
<p>第一种元数据是 <code>null_count</code>，即列中 null 值的行数：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">null_count_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">null_count</span><span class="p">();</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">null_count_df</span><span class="p">);</span>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="err">┌───────┐</span>
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="err">│</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="err">│</span><span class="w"> </span><span class="o">---</span><span class="w">   </span><span class="err">│</span>
</span><span id="__span-76-8"><a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a><span class="err">│</span><span class="w"> </span><span class="kt">u32</span><span class="w">   </span><span class="err">│</span>
</span><span id="__span-76-9"><a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="err">╞═══════╡</span>
</span><span id="__span-76-10"><a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a><span class="err">│</span><span class="w"> </span><span class="mi">1</span><span class="w">     </span><span class="err">│</span>
</span><span id="__span-76-11"><a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a><span class="err">└───────┘</span>
</span></code></pre></div>
<p>第二种元数据是一个叫做有效性位图（validity bitmap）的数组，指示每个数据值是有效的还是缺失的。有效性位图在内存中是高效的，因为它是按位编码的 - 每个值要么是 0 要么是 1。这种按位编码意味着每个数组的内存开销仅为（数组长度 / 8）字节。有效性位图由 Polars 的 <code>is_null</code> 方法使用。</p>
<p>可以使用 <code>is_null</code> 方法返回基于有效性位图的 Series：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">is_null_series</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="w">    </span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">).</span><span class="n">is_null</span><span class="p">()])</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">is_null_series</span><span class="p">);</span>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="err">┌───────┐</span>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a><span class="err">│</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a><span class="err">│</span><span class="w"> </span><span class="o">---</span><span class="w">   </span><span class="err">│</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a><span class="err">│</span><span class="w"> </span><span class="kt">bool</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a><span class="err">╞═══════╡</span>
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a><span class="err">│</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a><span class="err">│</span><span class="w"> </span><span class="kc">true</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a><span class="err">└───────┘</span>
</span></code></pre></div>
<h3 id="_45">填充缺失数据<a class="headerlink" href="#_45" title="Permanent link">&para;</a></h3>
<p>可以使用 <code>fill_null</code> 方法填充 Series 中的缺失数据。您需要指定希望 <code>fill_null</code> 方法如何填充缺失数据。主要有以下几种方式：</p>
<ol>
<li>使用字面值，例如 0 或 "0"</li>
<li>使用策略，例如前向填充</li>
<li>使用表达式，例如用另一列的值替换</li>
<li>插值</li>
</ol>
<p>我们通过定义一个简单的 DataFrame，其中 col2 有一个缺失值，来说明每种填充缺失值的方法：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="w">    </span><span class="s">&quot;col1&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="w">    </span><span class="s">&quot;col2&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">df</span><span class="p">);</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="err">┌──────┬──────┐</span>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a><span class="err">│</span><span class="w"> </span><span class="n">col1</span><span class="w"> </span><span class="err">┆</span><span class="w"> </span><span class="n">col2</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="err">│</span><span class="w"> </span><span class="o">---</span><span class="w">  </span><span class="err">┆</span><span class="w"> </span><span class="o">---</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="err">│</span><span class="w"> </span><span class="kt">i64</span><span class="w">  </span><span class="err">┆</span><span class="w"> </span><span class="kt">i64</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-78-12"><a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a><span class="err">╞══════╪══════╡</span>
</span><span id="__span-78-13"><a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a><span class="err">│</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="err">│</span>
</span><span id="__span-78-14"><a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a><span class="err">│</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="n">null</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-78-15"><a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a><span class="err">│</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="err">│</span>
</span><span id="__span-78-16"><a id="__codelineno-78-16" name="__codelineno-78-16" href="#__codelineno-78-16"></a><span class="err">└──────┴──────┘</span>
</span></code></pre></div>
<h4 id="_46">使用指定字面值填充<a class="headerlink" href="#_46" title="Permanent link">&para;</a></h4>
<p>我们可以用一个指定的字面值填充缺失数据：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">fill_literal_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="w">    </span><span class="p">.</span><span class="n">with_columns</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;col2&quot;</span><span class="p">).</span><span class="n">fill_null</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">2</span><span class="p">))])</span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fill_literal_df</span><span class="p">);</span>
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="err">┌──────┬──────┐</span>
</span><span id="__span-79-10"><a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a><span class="err">│</span><span class="w"> </span><span class="n">col1</span><span class="w"> </span><span class="err">┆</span><span class="w"> </span><span class="n">col2</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-79-11"><a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="err">│</span><span class="w"> </span><span class="o">---</span><span class="w">  </span><span class="err">┆</span><span class="w"> </span><span class="o">---</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-79-12"><a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a><span class="err">│</span><span class="w"> </span><span class="kt">i64</span><span class="w">  </span><span class="err">┆</span><span class="w"> </span><span class="kt">i64</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-79-13"><a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a><span class="err">╞══════╪══════╡</span>
</span><span id="__span-79-14"><a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a><span class="err">│</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="err">│</span>
</span><span id="__span-79-15"><a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a><span class="err">│</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="err">│</span>
</span><span id="__span-79-16"><a id="__codelineno-79-16" name="__codelineno-79-16" href="#__codelineno-79-16"></a><span class="err">│</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="err">│</span>
</span><span id="__span-79-17"><a id="__codelineno-79-17" name="__codelineno-79-17" href="#__codelineno-79-17"></a><span class="err">└──────┴──────┘</span>
</span></code></pre></div>
<h4 id="_47">使用策略填充<a class="headerlink" href="#_47" title="Permanent link">&para;</a></h4>
<p>我们可以用一种策略来填充缺失数据，例如前向填充：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">fill_forward_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="w">    </span><span class="p">.</span><span class="n">with_columns</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;col2&quot;</span><span class="p">).</span><span class="n">forward_fill</span><span class="p">(</span><span class="nb">None</span><span class="p">)])</span>
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fill_forward_df</span><span class="p">);</span>
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a>
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-80-9"><a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a><span class="err">┌──────┬──────┐</span>
</span><span id="__span-80-10"><a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a><span class="err">│</span><span class="w"> </span><span class="n">col1</span><span class="w"> </span><span class="err">┆</span><span class="w"> </span><span class="n">col2</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-80-11"><a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a><span class="err">│</span><span class="w"> </span><span class="o">---</span><span class="w">  </span><span class="err">┆</span><span class="w"> </span><span class="o">---</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-80-12"><a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a><span class="err">│</span><span class="w"> </span><span class="kt">i64</span><span class="w">  </span><span class="err">┆</span><span class="w"> </span><span class="kt">i64</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-80-13"><a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a><span class="err">╞══════╪══════╡</span>
</span><span id="__span-80-14"><a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a><span class="err">│</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="err">│</span>
</span><span id="__span-80-15"><a id="__codelineno-80-15" name="__codelineno-80-15" href="#__codelineno-80-15"></a><span class="err">│</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="err">│</span>
</span><span id="__span-80-16"><a id="__codelineno-80-16" name="__codelineno-80-16" href="#__codelineno-80-16"></a><span class="err">│</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="err">│</span>
</span><span id="__span-80-17"><a id="__codelineno-80-17" name="__codelineno-80-17" href="#__codelineno-80-17"></a><span class="err">└──────┴──────┘</span>
</span></code></pre></div>
<h4 id="_48">使用表达式填充<a class="headerlink" href="#_48" title="Permanent link">&para;</a></h4>
<p>为了更灵活地填充缺失数据，我们可以使用表达式。例如，用该列的中位数填充 null 值：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">fill_median_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="w">    </span><span class="p">.</span><span class="n">with_columns</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;col2&quot;</span><span class="p">).</span><span class="n">fill_null</span><span class="p">(</span><span class="n">median</span><span class="p">(</span><span class="s">&quot;col2&quot;</span><span class="p">))])</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fill_median_df</span><span class="p">);</span>
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a>
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-81-9"><a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a><span class="err">┌──────┬──────┐</span>
</span><span id="__span-81-10"><a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a><span class="err">│</span><span class="w"> </span><span class="n">col1</span><span class="w"> </span><span class="err">┆</span><span class="w"> </span><span class="n">col2</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-81-11"><a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a><span class="err">│</span><span class="w"> </span><span class="o">---</span><span class="w">  </span><span class="err">┆</span><span class="w"> </span><span class="o">---</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-81-12"><a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a><span class="err">│</span><span class="w"> </span><span class="kt">i64</span><span class="w">  </span><span class="err">┆</span><span class="w"> </span><span class="kt">f64</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-81-13"><a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a><span class="err">╞══════╪══════╡</span>
</span><span id="__span-81-14"><a id="__codelineno-81-14" name="__codelineno-81-14" href="#__codelineno-81-14"></a><span class="err">│</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="mf">1.0</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-81-15"><a id="__codelineno-81-15" name="__codelineno-81-15" href="#__codelineno-81-15"></a><span class="err">│</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="mf">2.0</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-81-16"><a id="__codelineno-81-16" name="__codelineno-81-16" href="#__codelineno-81-16"></a><span class="err">│</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="mf">3.0</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-81-17"><a id="__codelineno-81-17" name="__codelineno-81-17" href="#__codelineno-81-17"></a><span class="err">└──────┴──────┘</span>
</span></code></pre></div>
<p>在这种情况下，由于中位数是浮点数统计数据，列从整数类型转换为浮点类型。</p>
<h4 id="_49">使用插值填充<a class="headerlink" href="#_49" title="Permanent link">&para;</a></h4>
<p>此外，我们可以使用插值（不使用 <code>fill_null</code> 函数）来填充 null 值：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">fill_interpolation_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="w">    </span><span class="p">.</span><span class="n">with_columns</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;col2&quot;</span><span class="p">).</span><span class="n">interpolate</span><span class="p">(</span><span class="n">InterpolationMethod</span><span class="p">::</span><span class="n">Linear</span><span class="p">)])</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fill_interpolation_df</span><span class="p">);</span>
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a>
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a><span class="err">┌──────┬──────┐</span>
</span><span id="__span-82-10"><a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a><span class="err">│</span><span class="w"> </span><span class="n">col1</span><span class="w"> </span><span class="err">┆</span><span class="w"> </span><span class="n">col2</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-82-11"><a id="__codelineno-82-11" name="__codelineno-82-11" href="#__codelineno-82-11"></a><span class="err">│</span><span class="w"> </span><span class="o">---</span><span class="w">  </span><span class="err">┆</span><span class="w"> </span><span class="o">---</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-82-12"><a id="__codelineno-82-12" name="__codelineno-82-12" href="#__codelineno-82-12"></a><span class="err">│</span><span class="w"> </span><span class="kt">i64</span><span class="w">  </span><span class="err">┆</span><span class="w"> </span><span class="kt">f64</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-82-13"><a id="__codelineno-82-13" name="__codelineno-82-13" href="#__codelineno-82-13"></a><span class="err">╞══════╪══════╡</span>
</span><span id="__span-82-14"><a id="__codelineno-82-14" name="__codelineno-82-14" href="#__codelineno-82-14"></a><span class="err">│</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="mf">1.0</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-82-15"><a id="__codelineno-82-15" name="__codelineno-82-15" href="#__codelineno-82-15"></a><span class="err">│</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="mf">2.0</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-82-16"><a id="__codelineno-82-16" name="__codelineno-82-16" href="#__codelineno-82-16"></a><span class="err">│</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="err">┆</span><span class="w"> </span><span class="mf">3.0</span><span class="w">  </span><span class="err">│</span>
</span><span id="__span-82-17"><a id="__codelineno-82-17" name="__codelineno-82-17" href="#__codelineno-82-17"></a><span class="err">└──────┴──────┘</span>
</span></code></pre></div>
<h3 id="nan">NaN 值<a class="headerlink" href="#nan" title="Permanent link">&para;</a></h3>
<p>Series 中的缺失数据有一个 null 值。然而，您可以在浮点数数据类型的列中使用 NaN 值。这些 NaN 值可以由 Numpy 的 <code>np.nan</code> 或原生的 <code>float('nan')</code> 创建：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">nan_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">!</span><span class="p">(</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="w">    </span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">::</span><span class="n">NAN</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">::</span><span class="n">NAN</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p">],</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nan_df</span><span class="p">);</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="err">┌───────┐</span>
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="err">│</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="err">│</span>
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="err">│</span><span class="w"> </span><span class="o">---</span><span class="w">   </span><span class="err">│</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="err">│</span><span class="w"> </span><span class="kt">f64</span><span class="w">   </span><span class="err">│</span>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="err">╞═══════╡</span>
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a><span class="err">│</span><span class="w"> </span><span class="mf">1.0</span><span class="w">   </span><span class="err">│</span>
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a><span class="err">│</span><span class="w"> </span><span class="n">NaN</span><span class="w">   </span><span class="err">│</span>
</span><span id="__span-83-14"><a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a><span class="err">│</span><span class="w"> </span><span class="n">NaN</span><span class="w">   </span><span class="err">│</span>
</span><span id="__span-83-15"><a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a><span class="err">│</span><span class="w"> </span><span class="mf">3.0</span><span class="w">   </span><span class="err">│</span>
</span><span id="__span-83-16"><a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a><span class="err">└───────┘</span>
</span></code></pre></div>
<p>NaN 值被视为浮点数据类型的一部分，而不是缺失数据。这意味着：</p>
<ul>
<li>NaN 值不会被 <code>null_count</code> 方法计数。</li>
<li>当您使用 <code>fill_nan</code> 方法时，NaN 值会被填充，但不会被 <code>fill_null</code> 方法填充。</li>
</ul>
<p>Polars 具有 <code>is_nan</code> 和 <code>fill_nan</code> 方法，类似于 <code>is_null</code> 和 <code>fill_null</code> 方法。基础 Arrow 数组没有预先计算的 NaN 值有效位图，因此 <code>is_nan</code> 方法必须计算这个位图。</p>
<p>null 和 NaN 值之间的另一个区别是，计算包含 null 值的列的平均值时，会排除 null 值，而包含 NaN 值的列的平均值结果为 NaN。这种行为可以通过用 null 值替换 NaN 值来避免：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">mean_nan_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nan_df</span>
</span></code></pre></div>
<h3 id="2338-window-functions">23.3.8 窗口函数 Window functions<a class="headerlink" href="#2338-window-functions" title="Permanent link">&para;</a></h3>
<h2 id="_50">窗口函数<a class="headerlink" href="#_50" title="Permanent link">&para;</a></h2>
<p>窗口函数是带有超级功能的表达式。它们允许您在选择上下文中对分组进行聚合。首先，我们创建一个数据集。在下面的代码片段中加载的数据集包含一些关于金融股票的信息：</p>
<h3 id="_51">数据集示例<a class="headerlink" href="#_51" title="Permanent link">&para;</a></h3>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="k">use</span><span class="w"> </span><span class="n">reqwest</span><span class="p">::</span><span class="n">blocking</span><span class="p">::</span><span class="n">Client</span><span class="p">;</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Client</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="w">    </span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;https://example.com/financial_data.csv&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// 替换为实际的金融数据链接</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="w">    </span><span class="p">.</span><span class="n">send</span><span class="p">()</span><span class="o">?</span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="w">    </span><span class="p">.</span><span class="n">text</span><span class="p">()</span><span class="o">?</span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="w">    </span><span class="p">.</span><span class="n">bytes</span><span class="p">()</span>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">();</span>
</span><span id="__span-85-10"><a id="__codelineno-85-10" name="__codelineno-85-10" href="#__codelineno-85-10"></a>
</span><span id="__span-85-11"><a id="__codelineno-85-11" name="__codelineno-85-11" href="#__codelineno-85-11"></a><span class="kd">let</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Cursor</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</span><span id="__span-85-12"><a id="__codelineno-85-12" name="__codelineno-85-12" href="#__codelineno-85-12"></a><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CsvReadOptions</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
</span><span id="__span-85-13"><a id="__codelineno-85-13" name="__codelineno-85-13" href="#__codelineno-85-13"></a><span class="w">    </span><span class="p">.</span><span class="n">with_has_header</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-85-14"><a id="__codelineno-85-14" name="__codelineno-85-14" href="#__codelineno-85-14"></a><span class="w">    </span><span class="p">.</span><span class="n">into_reader_with_file_handle</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="__span-85-15"><a id="__codelineno-85-15" name="__codelineno-85-15" href="#__codelineno-85-15"></a><span class="w">    </span><span class="p">.</span><span class="n">finish</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-85-16"><a id="__codelineno-85-16" name="__codelineno-85-16" href="#__codelineno-85-16"></a>
</span><span id="__span-85-17"><a id="__codelineno-85-17" name="__codelineno-85-17" href="#__codelineno-85-17"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="_52">在选择上下文中的分组聚合<a class="headerlink" href="#_52" title="Permanent link">&para;</a></h3>
<p>下面展示了如何使用窗口函数在不同的列上进行分组并对它们进行聚合。这使得我们可以在单个查询中使用多个并行的分组操作。聚合的结果会投影回原始行，因此窗口函数几乎总是会导致一个与原始大小相同的 DataFrame。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="w">    </span><span class="p">.</span><span class="n">select</span><span class="p">([</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="w">        </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;sector&quot;</span><span class="p">),</span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="w">        </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;market_cap&quot;</span><span class="p">),</span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a><span class="w">        </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">)</span>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a><span class="w">            </span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="w">            </span><span class="p">.</span><span class="n">over</span><span class="p">([</span><span class="s">&quot;sector&quot;</span><span class="p">])</span>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a><span class="w">            </span><span class="p">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;avg_price_by_sector&quot;</span><span class="p">),</span>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="w">        </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;volume&quot;</span><span class="p">)</span>
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a><span class="w">            </span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a><span class="w">            </span><span class="p">.</span><span class="n">over</span><span class="p">([</span><span class="s">&quot;sector&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;market_cap&quot;</span><span class="p">])</span>
</span><span id="__span-86-14"><a id="__codelineno-86-14" name="__codelineno-86-14" href="#__codelineno-86-14"></a><span class="w">            </span><span class="p">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;avg_volume_by_sector_and_market_cap&quot;</span><span class="p">),</span>
</span><span id="__span-86-15"><a id="__codelineno-86-15" name="__codelineno-86-15" href="#__codelineno-86-15"></a><span class="w">        </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">).</span><span class="n">mean</span><span class="p">().</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;avg_price&quot;</span><span class="p">),</span>
</span><span id="__span-86-16"><a id="__codelineno-86-16" name="__codelineno-86-16" href="#__codelineno-86-16"></a><span class="w">    </span><span class="p">])</span>
</span><span id="__span-86-17"><a id="__codelineno-86-17" name="__codelineno-86-17" href="#__codelineno-86-17"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-86-18"><a id="__codelineno-86-18" name="__codelineno-86-18" href="#__codelineno-86-18"></a>
</span><span id="__span-86-19"><a id="__codelineno-86-19" name="__codelineno-86-19" href="#__codelineno-86-19"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="_53">每个分组内的操作<a class="headerlink" href="#_53" title="Permanent link">&para;</a></h3>
<p>窗口函数不仅可以用于聚合，还可以在分组内执行其他操作。例如，如果您想对分组内的值进行排序，可以使用 <code>col("value").sort().over("group")</code>。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="w">    </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;market_cap&quot;</span><span class="p">).</span><span class="n">gt</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">1000000000</span><span class="p">)))</span><span class="w">  </span><span class="c1">// 过滤市值大于 10 亿的公司</span>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="w">    </span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;company&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;sector&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">)])</span>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a>
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">filtered</span><span class="p">);</span>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a>
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filtered</span>
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a><span class="w">    </span><span class="p">.</span><span class="n">with_columns</span><span class="p">([</span><span class="n">cols</span><span class="p">([</span><span class="s">&quot;company&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;price&quot;</span><span class="p">])</span>
</span><span id="__span-87-13"><a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a><span class="w">        </span><span class="p">.</span><span class="n">sort_by</span><span class="p">(</span>
</span><span id="__span-87-14"><a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a><span class="w">            </span><span class="p">[</span><span class="s">&quot;price&quot;</span><span class="p">],</span>
</span><span id="__span-87-15"><a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a><span class="w">            </span><span class="n">SortMultipleOptions</span><span class="p">::</span><span class="n">default</span><span class="p">().</span><span class="n">with_order_descending</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-87-16"><a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-87-17"><a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a><span class="w">        </span><span class="p">.</span><span class="n">over</span><span class="p">([</span><span class="s">&quot;sector&quot;</span><span class="p">])])</span>
</span><span id="__span-87-18"><a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-87-19"><a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
</span></code></pre></div>
<p>Polars 会跟踪每个分组的位置，并将表达式映射到正确的行位置。这也适用于在单个选择中对不同分组的操作。</p>
<h3 id="_54">窗口表达式规则<a class="headerlink" href="#_54" title="Permanent link">&para;</a></h3>
<p>假设我们将其应用于 <code>pl.Int32</code> 列，窗口表达式的评估如下：</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="c1">// 在分组内聚合并广播</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">).</span><span class="n">over</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;sector&quot;</span><span class="p">)]);</span>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="c1">// 在分组内求和并与分组元素相乘</span>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;volume&quot;</span><span class="p">).</span><span class="n">sum</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">))</span>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="w">    </span><span class="p">.</span><span class="n">over</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;sector&quot;</span><span class="p">)])</span>
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="w">    </span><span class="p">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;volume_price_sum&quot;</span><span class="p">);</span>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="c1">// 在分组内求和并与分组元素相乘并将分组聚合为列表</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;volume&quot;</span><span class="p">).</span><span class="n">sum</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">))</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a><span class="w">    </span><span class="p">.</span><span class="n">over</span><span class="p">([</span><span class="n">col</span><span class="p">(</span><span class="s">&quot;sector&quot;</span><span class="p">)])</span>
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a><span class="w">    </span><span class="p">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;volume_price_list&quot;</span><span class="p">)</span>
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a><span class="w">    </span><span class="p">.</span><span class="n">flatten</span><span class="p">();</span>
</span></code></pre></div>
<h3 id="_55">更多示例<a class="headerlink" href="#_55" title="Permanent link">&para;</a></h3>
<p>下面是一些窗口函数的练习示例：</p>
<ol>
<li>按行业对所有公司进行排序。</li>
<li>选择每个行业中的前三家公司作为 "top_3_in_sector"。</li>
<li>按价格对公司进行降序排序，并选择每个行业中的前三家公司作为 "top_3_by_price"。</li>
<li>按市值对公司进行降序排序，并选择每个行业中的前三家公司作为 "top_3_by_market_cap"。</li>
</ol>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="w">    </span><span class="p">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="w">    </span><span class="p">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="w">    </span><span class="p">.</span><span class="n">select</span><span class="p">([</span>
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="w">        </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;sector&quot;</span><span class="p">).</span><span class="n">head</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="mi">3</span><span class="p">)).</span><span class="n">over</span><span class="p">([</span><span class="s">&quot;sector&quot;</span><span class="p">]).</span><span class="n">flatten</span><span class="p">(),</span>
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="w">        </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;company&quot;</span><span class="p">)</span>
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="w">            </span><span class="p">.</span><span class="n">sort_by</span><span class="p">(</span>
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="w">                </span><span class="p">[</span><span class="s">&quot;price&quot;</span><span class="p">],</span>
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="w">                </span><span class="n">SortMultipleOptions</span><span class="p">::</span><span class="n">default</span><span class="p">().</span><span class="n">with_order_descending</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="w">            </span><span class="p">)</span>
</span><span id="__span-89-11"><a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a><span class="w">            </span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span><span id="__span-89-12"><a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a><span class="w">            </span><span class="p">.</span><span class="n">over</span><span class="p">([</span><span class="s">&quot;sector&quot;</span><span class="p">])</span>
</span><span id="__span-89-13"><a id="__codelineno-89-13" name="__codelineno-89-13" href="#__codelineno-89-13"></a><span class="w">            </span><span class="p">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="__span-89-14"><a id="__codelineno-89-14" name="__codelineno-89-14" href="#__codelineno-89-14"></a><span class="w">            </span><span class="p">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;top_3_by_price&quot;</span><span class="p">),</span>
</span><span id="__span-89-15"><a id="__codelineno-89-15" name="__codelineno-89-15" href="#__codelineno-89-15"></a><span class="w">        </span><span class="n">col</span><span class="p">(</span><span class="s">&quot;company&quot;</span><span class="p">)</span>
</span><span id="__span-89-16"><a id="__codelineno-89-16" name="__codelineno-89-16" href="#__codelineno-89-16"></a><span class="w">            </span><span class="p">.</span><span class="n">sort_by</span><span class="p">(</span>
</span><span id="__span-89-17"><a id="__codelineno-89-17" name="__codelineno-89-17" href="#__codelineno-89-17"></a><span class="w">                </span><span class="p">[</span><span class="s">&quot;market_cap&quot;</span><span class="p">],</span>
</span><span id="__span-89-18"><a id="__codelineno-89-18" name="__codelineno-89-18" href="#__codelineno-89-18"></a><span class="w">                </span><span class="n">SortMultipleOptions</span><span class="p">::</span><span class="n">default</span><span class="p">().</span><span class="n">with_order_descending</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-89-19"><a id="__codelineno-89-19" name="__codelineno-89-19" href="#__codelineno-89-19"></a><span class="w">            </span><span class="p">)</span>
</span><span id="__span-89-20"><a id="__codelineno-89-20" name="__codelineno-89-20" href="#__codelineno-89-20"></a><span class="w">            </span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span><span id="__span-89-21"><a id="__codelineno-89-21" name="__codelineno-89-21" href="#__codelineno-89-21"></a><span class="w">            </span><span class="p">.</span><span class="n">over</span><span class="p">([</span><span class="s">&quot;sector&quot;</span><span class="p">])</span>
</span><span id="__span-89-22"><a id="__codelineno-89-22" name="__codelineno-89-22" href="#__codelineno-89-22"></a><span class="w">            </span><span class="p">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="__span-89-23"><a id="__codelineno-89-23" name="__codelineno-89-23" href="#__codelineno-89-23"></a><span class="w">            </span><span class="p">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;top_3_by_market_cap&quot;</span><span class="p">),</span>
</span><span id="__span-89-24"><a id="__codelineno-89-24" name="__codelineno-89-24" href="#__codelineno-89-24"></a><span class="w">    </span><span class="p">])</span>
</span><span id="__span-89-25"><a id="__codelineno-89-25" name="__codelineno-89-25" href="#__codelineno-89-25"></a><span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-89-26"><a id="__codelineno-89-26" name="__codelineno-89-26" href="#__codelineno-89-26"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
</span></code></pre></div>
<p>在量化金融中，这些窗口函数可以帮助我们对股票数据进行复杂的分析和聚合操作，例如计算行业内的平均价格，筛选出每个行业中价格最高的公司等。通过这些功能，我们可以更高效地处理和分析大量的金融数据。</p>
<h3 id="polarsdataframe">案例：序列化 &amp; 转化为polars的dataframe<a class="headerlink" href="#polarsdataframe" title="Permanent link">&para;</a></h3>
<p>为了简单说明序列化和反序列化在polars中的作用，我写了这段MWE代码以演示了如何定义一个包含历史股票数据的结构体，将数据序列化为 JSON 字符串，然后使用 Polars 库创建一个数据框架并打印出来。这对于介绍如何处理金融数据以及使用 Rust 进行数据分析非常有用。</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="c1">// 引入所需的库</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="k">use</span><span class="w"> </span><span class="n">serde</span><span class="p">::{</span><span class="n">Serialize</span><span class="p">,</span><span class="w"> </span><span class="n">Deserialize</span><span class="p">};</span><span class="w"> </span><span class="c1">// 用于序列化和反序列化</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="k">use</span><span class="w"> </span><span class="n">serde_json</span><span class="p">;</span><span class="w"> </span><span class="c1">// 用于处理 JSON 数据</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="k">use</span><span class="w"> </span><span class="n">polars</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span><span class="w"> </span><span class="c1">// 使用 Polars 处理数据</span>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Cursor</span><span class="p">;</span><span class="w"> </span><span class="c1">// 用于创建内存中的数据流</span>
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a>
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a><span class="c1">// 定义一个结构体，表示中国A股的历史股票数据</span>
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="cp">#[derive(Debug, Serialize, Deserialize)]</span>
</span><span id="__span-90-9"><a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a><span class="k">struct</span><span class="w"> </span><span class="nc">StockZhAHist</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-10"><a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a><span class="w">    </span><span class="n">date</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">         </span><span class="c1">// 日期</span>
</span><span id="__span-90-11"><a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a><span class="w">    </span><span class="n">open</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w">            </span><span class="c1">// 开盘价</span>
</span><span id="__span-90-12"><a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a><span class="w">    </span><span class="n">close</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w">           </span><span class="c1">// 收盘价</span>
</span><span id="__span-90-13"><a id="__codelineno-90-13" name="__codelineno-90-13" href="#__codelineno-90-13"></a><span class="w">    </span><span class="n">high</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w">            </span><span class="c1">// 最高价</span>
</span><span id="__span-90-14"><a id="__codelineno-90-14" name="__codelineno-90-14" href="#__codelineno-90-14"></a><span class="w">    </span><span class="n">low</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w">             </span><span class="c1">// 最低价</span>
</span><span id="__span-90-15"><a id="__codelineno-90-15" name="__codelineno-90-15" href="#__codelineno-90-15"></a><span class="w">    </span><span class="n">volume</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w">          </span><span class="c1">// 交易量</span>
</span><span id="__span-90-16"><a id="__codelineno-90-16" name="__codelineno-90-16" href="#__codelineno-90-16"></a><span class="w">    </span><span class="n">turnover</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w">        </span><span class="c1">// 成交额</span>
</span><span id="__span-90-17"><a id="__codelineno-90-17" name="__codelineno-90-17" href="#__codelineno-90-17"></a><span class="w">    </span><span class="n">amplitude</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w">       </span><span class="c1">// 振幅</span>
</span><span id="__span-90-18"><a id="__codelineno-90-18" name="__codelineno-90-18" href="#__codelineno-90-18"></a><span class="w">    </span><span class="n">change_rate</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w">     </span><span class="c1">// 涨跌幅</span>
</span><span id="__span-90-19"><a id="__codelineno-90-19" name="__codelineno-90-19" href="#__codelineno-90-19"></a><span class="w">    </span><span class="n">change_amount</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w">   </span><span class="c1">// 涨跌额</span>
</span><span id="__span-90-20"><a id="__codelineno-90-20" name="__codelineno-90-20" href="#__codelineno-90-20"></a><span class="w">    </span><span class="n">turnover_rate</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w">   </span><span class="c1">// 换手率</span>
</span><span id="__span-90-21"><a id="__codelineno-90-21" name="__codelineno-90-21" href="#__codelineno-90-21"></a><span class="p">}</span>
</span><span id="__span-90-22"><a id="__codelineno-90-22" name="__codelineno-90-22" href="#__codelineno-90-22"></a>
</span><span id="__span-90-23"><a id="__codelineno-90-23" name="__codelineno-90-23" href="#__codelineno-90-23"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-24"><a id="__codelineno-90-24" name="__codelineno-90-24" href="#__codelineno-90-24"></a><span class="w">    </span><span class="c1">// 创建一个包含历史股票数据的向量</span>
</span><span id="__span-90-25"><a id="__codelineno-90-25" name="__codelineno-90-25" href="#__codelineno-90-25"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span>
</span><span id="__span-90-26"><a id="__codelineno-90-26" name="__codelineno-90-26" href="#__codelineno-90-26"></a><span class="w">        </span><span class="n">StockZhAHist</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">date</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1996-12-16T00:00:00.000&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="n">open</span><span class="p">:</span><span class="w"> </span><span class="mf">16.86</span><span class="p">,</span><span class="w"> </span><span class="n">close</span><span class="p">:</span><span class="w"> </span><span class="mf">16.86</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="p">:</span><span class="w"> </span><span class="mf">16.86</span><span class="p">,</span><span class="w"> </span><span class="n">low</span><span class="p">:</span><span class="w"> </span><span class="mf">16.86</span><span class="p">,</span><span class="w"> </span><span class="n">volume</span><span class="p">:</span><span class="w"> </span><span class="mf">62442.0</span><span class="p">,</span><span class="w"> </span><span class="n">turnover</span><span class="p">:</span><span class="w"> </span><span class="mf">105277000.0</span><span class="p">,</span><span class="w"> </span><span class="n">amplitude</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">change_rate</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mf">10.22</span><span class="p">,</span><span class="w"> </span><span class="n">change_amount</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1.92</span><span class="p">,</span><span class="w"> </span><span class="n">turnover_rate</span><span class="p">:</span><span class="w"> </span><span class="mf">0.87</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-90-27"><a id="__codelineno-90-27" name="__codelineno-90-27" href="#__codelineno-90-27"></a><span class="w">        </span><span class="n">StockZhAHist</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">date</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1996-12-17T00:00:00.000&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="n">open</span><span class="p">:</span><span class="w"> </span><span class="mf">15.17</span><span class="p">,</span><span class="w"> </span><span class="n">close</span><span class="p">:</span><span class="w"> </span><span class="mf">15.17</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="p">:</span><span class="w"> </span><span class="mf">16.79</span><span class="p">,</span><span class="w"> </span><span class="n">low</span><span class="p">:</span><span class="w"> </span><span class="mf">15.17</span><span class="p">,</span><span class="w"> </span><span class="n">volume</span><span class="p">:</span><span class="w"> </span><span class="mf">463675.0</span><span class="p">,</span><span class="w"> </span><span class="n">turnover</span><span class="p">:</span><span class="w"> </span><span class="mf">718902016.0</span><span class="p">,</span><span class="w"> </span><span class="n">amplitude</span><span class="p">:</span><span class="w"> </span><span class="mf">9.61</span><span class="p">,</span><span class="w"> </span><span class="n">change_rate</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mf">10.02</span><span class="p">,</span><span class="w"> </span><span class="n">change_amount</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1.69</span><span class="p">,</span><span class="w"> </span><span class="n">turnover_rate</span><span class="p">:</span><span class="w"> </span><span class="mf">6.49</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-90-28"><a id="__codelineno-90-28" name="__codelineno-90-28" href="#__codelineno-90-28"></a><span class="w">        </span><span class="n">StockZhAHist</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">date</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1996-12-18T00:00:00.000&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="n">open</span><span class="p">:</span><span class="w"> </span><span class="mf">15.23</span><span class="p">,</span><span class="w"> </span><span class="n">close</span><span class="p">:</span><span class="w"> </span><span class="mf">16.69</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="p">:</span><span class="w"> </span><span class="mf">16.69</span><span class="p">,</span><span class="w"> </span><span class="n">low</span><span class="p">:</span><span class="w"> </span><span class="mf">15.18</span><span class="p">,</span><span class="w"> </span><span class="n">volume</span><span class="p">:</span><span class="w"> </span><span class="mf">445380.0</span><span class="p">,</span><span class="w"> </span><span class="n">turnover</span><span class="p">:</span><span class="w"> </span><span class="mf">719400000.0</span><span class="p">,</span><span class="w"> </span><span class="n">amplitude</span><span class="p">:</span><span class="w"> </span><span class="mf">9.95</span><span class="p">,</span><span class="w"> </span><span class="n">change_rate</span><span class="p">:</span><span class="w"> </span><span class="mf">10.02</span><span class="p">,</span><span class="w"> </span><span class="n">change_amount</span><span class="p">:</span><span class="w"> </span><span class="mf">1.52</span><span class="p">,</span><span class="w"> </span><span class="n">turnover_rate</span><span class="p">:</span><span class="w"> </span><span class="mf">6.24</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-90-29"><a id="__codelineno-90-29" name="__codelineno-90-29" href="#__codelineno-90-29"></a><span class="w">        </span><span class="n">StockZhAHist</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">date</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1996-12-19T00:00:00.000&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="n">open</span><span class="p">:</span><span class="w"> </span><span class="mf">17.01</span><span class="p">,</span><span class="w"> </span><span class="n">close</span><span class="p">:</span><span class="w"> </span><span class="mf">16.4</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="p">:</span><span class="w"> </span><span class="mf">17.9</span><span class="p">,</span><span class="w"> </span><span class="n">low</span><span class="p">:</span><span class="w"> </span><span class="mf">15.99</span><span class="p">,</span><span class="w"> </span><span class="n">volume</span><span class="p">:</span><span class="w"> </span><span class="mf">572946.0</span><span class="p">,</span><span class="w"> </span><span class="n">turnover</span><span class="p">:</span><span class="w"> </span><span class="mf">970124992.0</span><span class="p">,</span><span class="w"> </span><span class="n">amplitude</span><span class="p">:</span><span class="w"> </span><span class="mf">11.44</span><span class="p">,</span><span class="w"> </span><span class="n">change_rate</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1.74</span><span class="p">,</span><span class="w"> </span><span class="n">change_amount</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mf">0.29</span><span class="p">,</span><span class="w"> </span><span class="n">turnover_rate</span><span class="p">:</span><span class="w"> </span><span class="mf">8.03</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-90-30"><a id="__codelineno-90-30" name="__codelineno-90-30" href="#__codelineno-90-30"></a><span class="w">    </span><span class="p">];</span>
</span><span id="__span-90-31"><a id="__codelineno-90-31" name="__codelineno-90-31" href="#__codelineno-90-31"></a>
</span><span id="__span-90-32"><a id="__codelineno-90-32" name="__codelineno-90-32" href="#__codelineno-90-32"></a><span class="w">    </span><span class="c1">// 将历史股票数据序列化为 JSON 字符串并打印出来</span>
</span><span id="__span-90-33"><a id="__codelineno-90-33" name="__codelineno-90-33" href="#__codelineno-90-33"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serde_json</span><span class="p">::</span><span class="n">to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-90-34"><a id="__codelineno-90-34" name="__codelineno-90-34" href="#__codelineno-90-34"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">json</span><span class="p">);</span>
</span><span id="__span-90-35"><a id="__codelineno-90-35" name="__codelineno-90-35" href="#__codelineno-90-35"></a>
</span><span id="__span-90-36"><a id="__codelineno-90-36" name="__codelineno-90-36" href="#__codelineno-90-36"></a><span class="w">    </span><span class="c1">// 从 JSON 字符串创建 Polars 数据框架</span>
</span><span id="__span-90-37"><a id="__codelineno-90-37" name="__codelineno-90-37" href="#__codelineno-90-37"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonReader</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Cursor</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>
</span><span id="__span-90-38"><a id="__codelineno-90-38" name="__codelineno-90-38" href="#__codelineno-90-38"></a><span class="w">        </span><span class="p">.</span><span class="n">finish</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
</span><span id="__span-90-39"><a id="__codelineno-90-39" name="__codelineno-90-39" href="#__codelineno-90-39"></a>
</span><span id="__span-90-40"><a id="__codelineno-90-40" name="__codelineno-90-40" href="#__codelineno-90-40"></a><span class="w">    </span><span class="c1">// 打印 Polars 数据框架</span>
</span><span id="__span-90-41"><a id="__codelineno-90-41" name="__codelineno-90-41" href="#__codelineno-90-41"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{:#?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>
</span><span id="__span-90-42"><a id="__codelineno-90-42" name="__codelineno-90-42" href="#__codelineno-90-42"></a><span class="p">}</span>
</span></code></pre></div>
<p>返回的 Polars Dataframe表格：</p>
<table>
<thead>
<tr>
<th>date</th>
<th>open</th>
<th>close</th>
<th>high</th>
<th>…</th>
<th>amplitude</th>
<th>change_rate</th>
<th>change_amount</th>
<th>turnover_rate</th>
</tr>
</thead>
<tbody>
<tr>
<td>str</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
<td></td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
</tr>
<tr>
<td>1996-12-16T00</td>
<td>16.86</td>
<td>16.86</td>
<td>16.86</td>
<td>…</td>
<td>0.0</td>
<td>-10.22</td>
<td>-1.92</td>
<td>0.87</td>
</tr>
<tr>
<td>0:00:00.000</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1996-12-17T00</td>
<td>15.17</td>
<td>15.17</td>
<td>16.79</td>
<td>…</td>
<td>9.61</td>
<td>-10.02</td>
<td>-1.69</td>
<td>6.49</td>
</tr>
<tr>
<td>0:00:00.000</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1996-12-18T00</td>
<td>15.23</td>
<td>16.69</td>
<td>16.69</td>
<td>…</td>
<td>9.95</td>
<td>10.02</td>
<td>1.52</td>
<td>6.24</td>
</tr>
<tr>
<td>0:00:00.000</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1996-12-19T00</td>
<td>17.01</td>
<td>16.4</td>
<td>17.9</td>
<td>…</td>
<td>11.44</td>
<td>-1.74</td>
<td>-0.29</td>
<td>8.03</td>
</tr>
<tr>
<td>0:00:00.000</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../../PART%20I%20%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/Chapter%2022%20-%20%20%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/" class="md-footer__link md-footer__link--prev" aria-label="上一页: Chapter 22 - 文件处理">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                Chapter 22 - 文件处理
              </div>
            </div>
          </a>
        
        
          
          <a href="../Chapter%2024%20-%20%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93Clickhouse/" class="md-footer__link md-footer__link--next" aria-label="下一页: Chapter 24 - 时序数据库Clickhouse">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                Chapter 24 - 时序数据库Clickhouse
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.footer", "navigation.indexes", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>